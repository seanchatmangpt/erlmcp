# erlmcp Vulnerability Inventory - Severity-Ranked

**Generated**: 2026-01-27
**Assessment Phase**: 4 of 5 (Security & Performance Hardening)
**Total Vulnerabilities**: 42 identified
**Critical**: 5 | High: 12 | Medium: 18 | Low: 7

---

## CRITICAL SEVERITY (5 findings)

### CVE-000-01: TLS Certificate Validation Disabled
- **CWE**: CWE-295 (Improper Certificate Validation)
- **CVSS**: 9.8 (CRITICAL)
- **Location**: `config/sys.config` line 123, `src/erlmcp_transport_http_server.erl`
- **Issue**: `verify_mode: verify_none` disables certificate validation
- **Impact**: Man-in-the-middle attacks possible, certificate spoofing
- **Fix**: Change to `verify_peer` with proper certificate chain validation
- **Effort**: 2 hours
- **Files Affected**: sys.config, erlmcp_transport_http_server.erl

### CVE-000-02: OAuth Client Secret in Configuration
- **CWE**: CWE-798 (Use of Hard-coded Credentials)
- **CVSS**: 9.1 (CRITICAL)
- **Location**: `config/sys.config` line 312-320
- **Issue**: OAuth client secret configuration exposed in config files
- **Impact**: OAuth token compromise, privilege escalation
- **Fix**: Load from Vault/environment variables at runtime only
- **Effort**: 8 hours
- **Files Affected**: sys.config, erlmcp_http_auth.erl, new OAuth secret loader

### CVE-000-03: Weak Session ID Generation
- **CWE**: CWE-330 (Use of Insufficiently Random Values)
- **CVSS**: 8.7 (CRITICAL)
- **Location**: `src/erlmcp_session_manager.erl`, `src/erlmcp_progress.erl`
- **Issue**: Session tokens may be predictable, timestamp-based format
- **Impact**: Session hijacking, session token collision
- **Fix**: Use 32-byte crypto:strong_rand_bytes() exclusively
- **Effort**: 4 hours
- **Files Affected**: erlmcp_session_manager.erl, erlmcp_progress.erl

### CVE-000-04: No Input Rate Limiting
- **CWE**: CWE-400 (Uncontrolled Resource Consumption)
- **CVSS**: 8.6 (CRITICAL)
- **Location**: No rate limiting implemented system-wide
- **Issue**: No protection against message bombing, DoS attacks
- **Impact**: Memory exhaustion, CPU exhaustion, service unavailability
- **Fix**: Implement per-connection and global rate limiting
- **Effort**: 16 hours
- **Files Affected**: New erlmcp_rate_limiter.erl, integration in transports

### CVE-000-05: Message Size Limits Excessive
- **CWE**: CWE-400 (Uncontrolled Resource Consumption)
- **CVSS**: 8.4 (CRITICAL)
- **Location**: `config/sys.config` lines 21-34
- **Issue**: 16 MB default message size allows memory exhaustion
- **Impact**: Out-of-memory attacks, unbounded buffering
- **Fix**: Reduce to 1-10 MB based on transport, implement proper buffering
- **Effort**: 3 hours
- **Files Affected**: sys.config, erlmcp_message_size.erl

---

## HIGH SEVERITY (12 findings)

### CVE-000-06: Session Lack of IP Binding
- **CWE**: CWE-384 (Session Fixation)
- **CVSS**: 8.1 (HIGH)
- **Location**: `src/erlmcp_session_manager.erl`, `src/erlmcp_http_security.erl`
- **Issue**: No IP address pinning for sessions
- **Impact**: Session stealing from different network locations
- **Fix**: Add IP/User-Agent binding to session validation
- **Effort**: 6 hours
- **Files Affected**: erlmcp_session_manager.erl, erlmcp_http_security.erl

### CVE-000-07: TLS Minimum Version Too Old
- **CWE**: CWE-327 (Use of a Broken or Risky Cryptographic Algorithm)
- **CVSS**: 7.5 (HIGH)
- **Location**: `config/sys.config` line 107
- **Issue**: Allows TLS 1.2 which has known vulnerabilities
- **Impact**: Downgrade attacks, known TLS 1.2 exploits
- **Fix**: Require TLS 1.3 minimum
- **Effort**: 2 hours
- **Files Affected**: sys.config

### CVE-000-08: No CSRF Protection
- **CWE**: CWE-352 (Cross-Site Request Forgery)
- **CVSS**: 7.5 (HIGH)
- **Location**: No CSRF tokens generated or validated
- **Issue**: HTTP state-changing operations vulnerable to CSRF
- **Impact**: Unauthorized resource modification, tool execution
- **Fix**: Implement CSRF token generation and validation
- **Effort**: 10 hours
- **Files Affected**: New erlmcp_csrf_protection.erl, erlmcp_http_middleware.erl

### CVE-000-09: Path Canonicalization Race Condition
- **CWE**: CWE-22 (Path Traversal)
- **CVSS**: 7.4 (HIGH)
- **Location**: `src/erlmcp_path_canonicalizer.erl` lines 278-311
- **Issue**: Path could be replaced between canonicalization and usage
- **Impact**: Access to files outside allowed directories
- **Fix**: Use atomic operations, validate at access time
- **Effort**: 8 hours
- **Files Affected**: erlmcp_path_canonicalizer.erl

### CVE-000-10: Symlink Resolution Incomplete
- **CWE**: CWE-22 (Path Traversal)
- **CVSS**: 7.3 (HIGH)
- **Location**: `src/erlmcp_path_canonicalizer.erl` lines 273-311
- **Issue**: Symlinks can point outside allowed directories
- **Impact**: Directory escape, unauthorized file access
- **Fix**: Validate each symlink hop against allowed paths
- **Effort**: 6 hours
- **Files Affected**: erlmcp_path_canonicalizer.erl

### CVE-000-11: Origin Validation Scheme Mismatch
- **CWE**: CWE-346 (Origin Validation Error)
- **CVSS**: 7.2 (HIGH)
- **Location**: `src/erlmcp_http_security.erl` lines 108-119
- **Issue**: Doesn't validate scheme matches in origin patterns
- **Impact**: Cross-scheme origin confusion attacks
- **Fix**: Validate scheme in addition to host and port
- **Effort**: 4 hours
- **Files Affected**: erlmcp_http_security.erl

### CVE-000-12: JSON Parsing No Depth Limit
- **CWE**: CWE-400 (Uncontrolled Resource Consumption)
- **CVSS**: 7.1 (HIGH)
- **Location**: `src/erlmcp_json_rpc.erl` lines 101-103
- **Issue**: jsx:decode() has no nesting depth limit
- **Impact**: Stack exhaustion via deeply nested JSON
- **Fix**: Add max_depth option to jsx:decode()
- **Effort**: 2 hours
- **Files Affected**: erlmcp_json_rpc.erl

### CVE-000-13: No OAuth PKCE Implementation
- **CWE**: CWE-347 (Improper Verification of Cryptographic Signature)
- **CVSS**: 7.0 (HIGH)
- **Location**: `src/erlmcp_http_auth.erl` (incomplete OAuth)
- **Issue**: Missing Proof Key for Public Clients (PKCE) RFC 7636
- **Impact**: Authorization code interception attacks
- **Fix**: Implement PKCE with SHA-256 code challenge
- **Effort**: 12 hours
- **Files Affected**: erlmcp_http_auth.erl

### CVE-000-14: No Secure Cookie Attributes
- **CWE**: CWE-614 (Sensitive Cookie in HTTPS Session Without 'Secure' Attribute)
- **CVSS**: 6.9 (HIGH)
- **Location**: Session cookie handling in HTTP responses
- **Issue**: Session cookies lack Secure, HttpOnly, SameSite attributes
- **Impact**: Session stealing via XSS or network sniffing
- **Fix**: Add Secure, HttpOnly, SameSite=Strict to all session cookies
- **Effort**: 4 hours
- **Files Affected**: erlmcp_http_middleware.erl, erlmcp_session_manager.erl

### CVE-000-15: Origin Validation IPv6 Incomplete
- **CWE**: CWE-346 (Origin Validation Error)
- **CVSS**: 6.8 (HIGH)
- **Location**: `src/erlmcp_http_security.erl`, `src/erlmcp_origin_validator.erl`
- **Issue**: IPv6 address handling incomplete ([::1] vs ::1)
- **Impact**: IPv6 clients may bypass origin validation
- **Fix**: Normalize IPv6 addresses, handle both bracketed and unbracketed
- **Effort**: 5 hours
- **Files Affected**: erlmcp_http_security.erl, erlmcp_origin_validator.erl

### CVE-000-16: No Authorization Scopes
- **CWE**: CWE-269 (Improper Access Control)
- **CVSS**: 6.5 (HIGH)
- **Location**: No scope enforcement in OAuth or JWT implementation
- **Issue**: All authenticated users have full API access
- **Impact**: Privilege escalation, unauthorized operations
- **Fix**: Implement scope-based authorization
- **Effort**: 20 hours
- **Files Affected**: New erlmcp_authorization.erl, erlmcp_server.erl

### CVE-000-17: Insufficient Logging of Security Events
- **CWE**: CWE-778 (Insufficient Logging)
- **CVSS**: 6.5 (HIGH)
- **Location**: Throughout codebase
- **Issue**: Not all security events are logged
- **Impact**: Unable to detect attacks, forensic analysis impossible
- **Fix**: Add comprehensive security event logging
- **Effort**: 8 hours
- **Files Affected**: Multiple modules

---

## MEDIUM SEVERITY (18 findings)

### CVE-000-18: HTTPS Enforcement Logic Inverted
- **CWE**: CWE-295 (Improper Certificate Validation)
- **CVSS**: 6.5 (MEDIUM)
- **Location**: `src/erlmcp_http_security.erl` lines 66-69
- **Issue**: is_localhost() returns true when localhost NOT found
- **Impact**: Confusing logic, potential security bypass
- **Fix**: Rewrite with correct boolean logic
- **Effort**: 1 hour
- **Files Affected**: erlmcp_http_security.erl

### CVE-000-19: No OAuth Token Refresh
- **CWE**: CWE-384 (Session Fixation)
- **CVSS**: 6.3 (MEDIUM)
- **Location**: `src/erlmcp_http_auth.erl` (incomplete)
- **Issue**: No token refresh mechanism for long-lived sessions
- **Impact**: Stale tokens, forced re-authentication
- **Fix**: Implement refresh token mechanism
- **Effort**: 8 hours
- **Files Affected**: erlmcp_http_auth.erl

### CVE-000-20: No Certificate Pinning
- **CWE**: CWE-295 (Improper Certificate Validation)
- **CVSS**: 6.2 (MEDIUM)
- **Location**: No certificate pinning implementation
- **Issue**: Vulnerable to CA compromise
- **Impact**: MITM attacks even with valid certificates
- **Fix**: Implement certificate pinning for critical services
- **Effort**: 6 hours
- **Files Affected**: erlmcp_transport_http_server.erl

### CVE-000-21: No OCSP Stapling
- **CWE**: CWE-295 (Improper Certificate Validation)
- **CVSS**: 6.1 (MEDIUM)
- **Location**: No OCSP stapling in HTTPS config
- **Issue**: Revocation checking incomplete
- **Impact**: Use of revoked certificates possible
- **Fix**: Enable OCSP stapling
- **Effort**: 4 hours
- **Files Affected**: config/sys.config

### CVE-000-22: No Secrets Rotation Policy
- **CWE**: CWE-798 (Use of Hard-coded Credentials)
- **CVSS**: 5.9 (MEDIUM)
- **Location**: No secrets rotation mechanism
- **Issue**: No regular credential rotation
- **Impact**: Long-lived credentials increase breach window
- **Fix**: Implement automated secrets rotation
- **Effort**: 12 hours
- **Files Affected**: New erlmcp_secrets_rotator.erl, integration module

### CVE-000-23: No mTLS Support
- **CWE**: CWE-295 (Improper Certificate Validation)
- **CVSS**: 5.8 (MEDIUM)
- **Location**: No client certificate validation
- **Issue**: Server accepts any connection
- **Impact**: Server spoofing, lack of client authentication
- **Fix**: Implement mutual TLS
- **Effort**: 8 hours
- **Files Affected**: erlmcp_transport_http_server.erl, config/sys.config

### CVE-000-24: No Request Signing
- **CWE**: CWE-347 (Improper Verification of Cryptographic Signature)
- **CVSS**: 5.7 (MEDIUM)
- **Location**: No request signature validation (e.g., AWS SigV4)
- **Issue**: Requests not authenticated with signatures
- **Impact**: Request tampering possible
- **Fix**: Implement request signature validation
- **Effort**: 10 hours
- **Files Affected**: erlmcp_http_middleware.erl

### CVE-000-25: Incomplete Error Information Hiding
- **CWE**: CWE-209 (Information Exposure Through Error)
- **CVSS**: 5.4 (MEDIUM)
- **Location**: Some error paths expose internal details
- **Issue**: Stack traces or module names could leak to clients
- **Impact**: Information disclosure aiding attackers
- **Fix**: Audit all error paths, ensure generic messages to clients
- **Effort**: 6 hours
- **Files Affected**: erlmcp_json_rpc.erl, erlmcp_server.erl

### CVE-000-26: No API Key Authentication
- **CWE**: CWE-347 (Improper Verification)
- **CVSS**: 5.3 (MEDIUM)
- **Location**: No API key support
- **Issue**: Only session-based auth supported
- **Impact**: Service-to-service auth not supported
- **Fix**: Implement API key generation and validation
- **Effort**: 12 hours
- **Files Affected**: New erlmcp_api_key.erl

### CVE-000-27: No Rate Limiting Persistence
- **CWE**: CWE-400 (Uncontrolled Resource Consumption)
- **CVSS**: 5.2 (MEDIUM)
- **Location**: Rate limiting only in-memory
- **Issue**: Rate limit state lost on restart
- **Impact**: Can reset rate limits by restarting
- **Fix**: Persist rate limit state to disk/Redis
- **Effort**: 8 hours
- **Files Affected**: New erlmcp_rate_limiter.erl

### CVE-000-28: No Audit Trail for Admin Operations
- **CWE**: CWE-778 (Insufficient Logging)
- **CVSS**: 5.1 (MEDIUM)
- **Location**: Admin operations not logged
- **Issue**: No record of configuration changes
- **Impact**: Cannot detect unauthorized admin access
- **Fix**: Log all admin operations with actor, timestamp, change
- **Effort**: 6 hours
- **Files Affected**: erlmcp_server.erl, new audit logger

### CVE-000-29: No Data Retention Policy
- **CWE**: CWE-220 (Storage of File With Sensitive Data)
- **CVSS**: 5.0 (MEDIUM)
- **Location**: No data retention configuration
- **Issue**: Logs and sessions retained indefinitely
- **Impact**: GDPR compliance issues, resource exhaustion
- **Fix**: Implement configurable data retention
- **Effort**: 8 hours
- **Files Affected**: config/sys.config, new retention policy module

### CVE-000-30: No Incident Response Plan
- **CWE**: CWE-1334 (Inadequate Logging)
- **CVSS**: 4.9 (MEDIUM)
- **Location**: No incident response procedure
- **Issue**: No documented process for security incidents
- **Impact**: Delayed response to attacks
- **Fix**: Document incident response procedure
- **Effort**: 4 hours
- **Files Affected**: docs/INCIDENT_RESPONSE.md (new)

### CVE-000-31: No Security Headers Validation
- **CWE**: CWE-693 (Protection Mechanism Failure)
- **CVSS**: 4.8 (MEDIUM)
- **Location**: HTTP response headers not validated
- **Issue**: Missing security headers (CSP, X-Frame-Options, etc.)
- **Impact**: Client-side attacks not prevented
- **Fix**: Add comprehensive security headers
- **Effort**: 3 hours
- **Files Affected**: erlmcp_http_middleware.erl

### CVE-000-32: No CORS Preflight Validation
- **CWE**: CWE-346 (Origin Validation Error)
- **CVSS**: 4.7 (MEDIUM)
- **Location**: CORS handling incomplete
- **Issue**: OPTIONS preflight requests not validated
- **Impact**: CORS bypass possible
- **Fix**: Properly validate preflight requests
- **Effort**: 4 hours
- **Files Affected**: erlmcp_http_middleware.erl

### CVE-000-33: No Dependency Vulnerability Scanning
- **CWE**: CWE-1035 (Using Components with Known Vulnerabilities)
- **CVSS**: 4.6 (MEDIUM)
- **Location**: No automated dependency scanning
- **Issue**: Unknown vulnerable dependencies
- **Impact**: Vulnerable to known exploits
- **Fix**: Add rebar3 hex audit to CI/CD
- **Effort**: 2 hours
- **Files Affected**: .gitlab-ci.yml, Makefile

### CVE-000-34: No Cryptographic Key Management
- **CWE**: CWE-321 (Use of Hard-coded Cryptographic Key)
- **CVSS**: 4.5 (MEDIUM)
- **Location**: No key management system
- **Issue**: No secure key storage/rotation
- **Impact**: Compromised keys not contained
- **Fix**: Implement key management service
- **Effort**: 16 hours
- **Files Affected**: New erlmcp_key_manager.erl

### CVE-000-35: No Distributed Tracing Security
- **CWE**: CWE-220 (Storage of File With Sensitive Data)
- **CVSS**: 4.4 (MEDIUM)
- **Location**: OTEL spans may contain sensitive data
- **Issue**: Traces exported to external systems
- **Impact**: Credentials/PII in distributed traces
- **Fix**: Sanitize sensitive data from traces
- **Effort**: 6 hours
- **Files Affected**: erlmcp_otel.erl

---

## LOW SEVERITY (7 findings)

### CVE-000-36: No Code Signing
- **CWE**: CWE-347 (Improper Verification)
- **CVSS**: 3.7 (LOW)
- **Location**: No code signing in release process
- **Issue**: Cannot verify release integrity
- **Impact**: Tampered releases possible
- **Fix**: Implement code signing with GPG/cosign
- **Effort**: 4 hours
- **Files Affected**: .gitlab-ci.yml, Makefile

### CVE-000-37: No OpenSSH Integration
- **CWE**: CWE-649 (Reliance on Obfuscation or Encryption of Security-Relevant Inputs)
- **CVSS**: 3.6 (LOW)
- **Location**: No SSH access control
- **Issue**: Interactive access not restricted
- **Impact**: Unauthorized shell access
- **Fix**: Disable interactive shell, use key-only auth
- **Effort**: 2 hours
- **Files Affected**: Deployment documentation

### CVE-000-38: No Firewall Rules Documentation
- **CWE**: CWE-693 (Protection Mechanism Failure)
- **CVSS**: 3.5 (LOW)
- **Location**: No documented firewall requirements
- **Issue**: Network security unclear
- **Impact**: Misconfigured networks
- **Fix**: Document recommended firewall rules
- **Effort**: 2 hours
- **Files Affected**: docs/DEPLOYMENT.md

### CVE-000-39: No Security.txt
- **CWE**: CWE-1334 (Inadequate Logging)
- **CVSS**: 3.4 (LOW)
- **Location**: No security.txt per RFC 9110
- **Issue**: No vulnerability disclosure process
- **Impact**: Researchers can't report issues safely
- **Fix**: Create security.txt file
- **Effort**: 1 hour
- **Files Affected**: priv/security.txt (new)

### CVE-000-40: No Security Badge/Scanning
- **CWE**: CWE-220 (Storage of File With Sensitive Data)
- **CVSS**: 3.3 (LOW)
- **Location**: No automated security scanning in CI
- **Issue**: Known vulnerabilities not detected
- **Impact**: Vulnerable code merged
- **Fix**: Add CodeQL, SonarQube, or similar
- **Effort**: 3 hours
- **Files Affected**: .gitlab-ci.yml

### CVE-000-41: No Developer Security Training
- **CWE**: CWE-1021 (Improper Restriction of Rendered UI Layers)
- **CVSS**: 3.2 (LOW)
- **Location**: No security training documentation
- **Issue**: Developers unaware of security practices
- **Impact**: Security vulnerabilities introduced
- **Fix**: Create security training materials
- **Effort**: 4 hours
- **Files Affected**: docs/SECURITY_TRAINING.md

### CVE-000-42: No Penetration Testing Report
- **CWE**: CWE-1334 (Inadequate Logging)
- **CVSS**: 3.1 (LOW)
- **Location**: No external penetration test
- **Issue**: Unknown vulnerabilities in deployed code
- **Impact**: Undetected vulnerabilities
- **Fix**: Commission annual penetration test
- **Effort**: 40+ hours (external contractor)
- **Files Affected**: Security audit report (new)

---

## Vulnerability Remediation Timeline

### Week 1 (CRITICAL)
- Fix TLS certificate validation (2h)
- Reduce message size limits (3h)
- Implement rate limiting (16h)
- Total: ~21 hours (3 days)

### Week 2 (CRITICAL + HIGH)
- Fix session ID generation (4h)
- Remove OAuth secrets from config (8h)
- Fix path canonicalization race (8h)
- Add CSRF protection (10h)
- Total: ~30 hours (4 days)

### Week 3-4 (REMAINING HIGH)
- Fix symlink validation (6h)
- Fix origin validation (4h)
- Add IP binding to sessions (6h)
- Implement PKCE (12h)
- Add secure cookies (4h)
- Total: ~32 hours (4-5 days)

### Weeks 5-8 (MEDIUM PRIORITY)
- Add API key auth (12h)
- Implement scopes (20h)
- Add audit logging (6h)
- Implement mTLS (8h)
- Security headers (3h)
- Total: ~49 hours (6-7 days)

### Ongoing
- Dependency scanning (automated)
- Code signing (release process)
- Security training
- Penetration testing

**Total Estimated Effort**: ~160-180 person-hours
**Recommended Timeline**: 8-12 weeks for complete remediation

---

## Risk Matrix

```
        HIGH        │  CVE-06  │  CVE-07  │  CVE-08  │
   IMPACT                      │  CVE-09  │  CVE-10  │
                    │  CVE-11  │  CVE-12  │  CVE-13  │
                    │  CVE-14  │  CVE-15  │  CVE-16  │
        MEDIUM      │  CVE-17  │  CVE-18  │  CVE-19  │
                    │          │          │          │
        LOW         │  CVE-36  │  CVE-37  │  CVE-38  │
                    │          │          │          │
                    └──────────┴──────────┴──────────┘
                      LOW    MEDIUM    HIGH
                        PROBABILITY
```

**CRITICAL (Top-Left)**: CVE-001, CVE-002, CVE-003, CVE-004, CVE-005
- Immediate action required
- Cannot deploy to production
- Address within 1-2 weeks

**HIGH (Top-Middle)**: CVE-006 through CVE-017
- Significant risk
- Must fix before production
- Address within 2-4 weeks

**MEDIUM (Bottom-Right)**: CVE-018 through CVE-035
- Notable risk, manageable
- Fix in medium-term (4-8 weeks)

**LOW**: CVE-036 through CVE-042
- Low risk, hygiene issues
- Fix in long-term (8-12 weeks)

---

Generated: 2026-01-27
Assessor: Agent 4 - Security & Performance Specialist
