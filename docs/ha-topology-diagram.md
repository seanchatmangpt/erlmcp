# HA Regional Deployment Topology Diagrams

## Overview
This document contains visual representations of the erlmcp v3 high availability architecture for multi-region deployment.

## Global Architecture

```
                           ┌─────────────────────────────────────────────────┐
                           │                 Global DNS                        │
                           │   (Route 53 / Cloudflare)                         │
                           │                                                 │
                           └───────────────┬─────────────────────────────────────┘
                                         │
           ┌─────────────────────────────┼─────────────────────────────────────┐
           │                             │                                     │
           ▼                             ▼                                     ▼
┌─────────────────────┐    ┌─────────────────────────┐    ┌─────────────────────┐
│   US-East-1 (40%)  │    │  EU-Central-1 (35%)     │    │ AP-Southeast-1 (25%)│
│ (Primary Region)   │    │ (Secondary Region)      │    │ (Tertiary Region)   │
└─────────────────────┘    └─────────────────────────┘    └─────────────────────┘
           │                             │                                     │
           └─────────────────────────────┼─────────────────────────────────────┘
                                         │
                           ┌───────────────┴─────────────────────────────────────┐
                           │       Global Load Balancer (GSLB)                  │
                           │           (Latency-based routing)                   │
                           └────────────────────┬────────────────────────────────┘
                                              │
                      ┌───────────────────────┼──────────────────────────────────┐
                      │                       │                                  │
                      ▼                       ▼                                  ▼
            ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
            │ Regional LB    │    │ Regional LB    │    │ Regional LB    │
            │ (ALB/NLB)     │    │ (ALB/NLB)     │    │ (ALB/NLB)     │
            └─────────────────┘    └─────────────────┘    └─────────────────┘
                      │                       │                                  │
                      └───────────────────────┼──────────────────────────────────┘
                                              │
                             ┌─────────────────┴──────────────────────────────────┐
                             │              CDN Distribution                   │
                             │       (CloudFront / Cloudflare)                 │
                             └────────────────────┬────────────────────────────────┘
                                                │
                                   ┌─────────────┼─────────────────────────────────┐
                                   │             │                                 │
                                   ▼             ▼                                 ▼
                           ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐
                           │   End Users     │  │   End Users    │  │   End Users    │
                           │   (NA)         │  │   (EU)         │  │   (APAC)       │
                           └─────────────────┘  └─────────────────┘  └─────────────────┘
```

## Regional Architecture (US-East-1 Example)

```
                       ┌─────────────────────────────────────────────────────────┐
                       │                 VPC: us-east-1-vpc                       │
                       │                                                        │
                       └─────────────────────┬─────────────────────────────────────┘
                                         │
           ┌─────────────────────────────┼─────────────────────────────────────────┐
           │                           │                                       │
           ▼                           ▼                                       ▼
┌─────────────────────┐    ┌─────────────────────────┐    ┌─────────────────────┐
│  Public Subnet      │    │   Private Subnet       │    │  Database Subnet    │
│  (10.0.1.0/24)      │    │   (10.0.2.0/24)       │    │  (10.0.3.0/24)       │
└─────────────────────┘    └─────────────────────────┘    └─────────────────────┘
           │                           │                                       │
           │                           │                                       │
           ▼                           ▼                                       ▼
┌─────────────────────┐    ┌─────────────────────────┐    ┌─────────────────────┐
│  Internet Gateway   │    │   Private Gateway     │    │   Private Gateway    │
│     (IGW)           │    │   (NAT Gateway)       │    │   (Transit Gateway)  │
└─────────────────────┘    └─────────────────────────┘    └─────────────────────┘
           │                           │                                       │
           └───────────────────────────┼───────────────────────────────────────┘
                                      │
                                      ▼
                           ┌─────────────────────────┐
                           │    Network ACLs        │
                           │    (Layer 3 Filtering)  │
                           └───────────────┬─────────┘
                                         │
                                         ▼
                           ┌─────────────────────────┐
                           │   Security Groups       │
                           │   (Stateful Firewall)   │
                           └───────────────┬─────────┘
                                         │
                                         ▼
                           ┌─────────────────────────┐
                           │      Region            │
                           │      (us-east-1)        │
                           │                        │
                           └───────────────┬─────────┘
                                         │
                      ┌───────────────────┼───────────────────────────────────────┐
                      │                   │                                     │
                      ▼                   ▼                                     ▼
            ┌─────────────────┐  ┌─────────────────┐    ┌─────────────────┐
            │   Zone A        │  │   Zone B        │    │   Zone C        │
            │ (us-east-1a)    │  │ (us-east-1b)    │    │ (us-east-1c)    │
            └─────────────────┘  └─────────────────┘    └─────────────────┘
                      │                   │                                     │
                      └───────────────────┼───────────────────────────────────────┘
                                        │
                                        ▼
                           ┌─────────────────────────┐
                           │      Cluster A          │
                           │   (Active-Active)       │
                           │                        │
                           └─────────────────────────┘
                                        │
              ┌──────────────────────────┼───────────────────────────────────────┐
              │                        │                                      │
              ▼                        ▼                                      ▼
    ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
    │  Node Pool 1     │    │  Node Pool 2     │    │  Node Pool 3     │
    │  (24 nodes)      │    │  (24 nodes)      │    │  (8 nodes)       │
    └─────────────────┘    └─────────────────┘    └─────────────────┘
```

## Node Architecture

```
┌────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                          │
│  ┌──────────────────────────────────────────────────────────────────────────────────────┐ │
│  │                                erlmcp_server Node                                      │ │
│  │                                                                                      │ │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐ │ │
│  │  │   gen_server     │  │   Registry       │  │   Session       │  │   Transport     │ │ │
│  │  │   Pool          │  │   Client         │  │   Manager       │  │   Layer         │ │ │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘  └─────────────────┘ │ │
│  │                        │                        │                        │             │ │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐ │ │
│  │  │   OTP           │  │   Metrics       │  │   Health        │  │   Monitoring    │ │ │
│  │  │   Supervisor     │  │   Collector      │  │   Monitor       │  │   Agent         │ │ │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘  └─────────────────┘ │ │
│  │                                                                                      │ │
│  │  ┌─────────────────────────────────────────────────────────────────────────────────┐ │ │
│  │  │                               Connection Pool                                    │ │ │
│  │  │                                                                                 │ │ │
│  │  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐        │ │ │
│  │  │  │   Redis      │  │  Database   │  │   Session    │  │   Cache      │        │ │ │
│  │  │  │   Cluster    │  │   Pool      │  │   Store      │  │   Layer      │        │ │ │
│  │  │  └──────────────┘  └──────────────┘  └──────────────┘  └──────────────┘        │ │ │
│  │  └─────────────────────────────────────────────────────────────────────────────────┘ │ │
│  └──────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                          │
└────────────────────────────────────────────────────────────────────────────────────────────┘
```

## Data Flow Architecture

```
Client Request Flow:
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Client        │    │   DNS/GSLB      │    │   Regional LB   │    │   Node Pool     │
│                 │    │                 │    │                 │    │                 │
│ 1. Request      │───▶│ 2. DNS Query   │───▶│ 3. Route        │───▶│ 4. Load Balance │
│                 │    │                 │    │                 │    │                 │
└─────────────────┘    └─────────────────┘    └─────────────────┘    └─────────────────┘
                                                                        │
                                                                        ▼
                                                                  ┌─────────────────┐
                                                                  │  erlmcp_server  │
                                                                  │                 │
                                                                  │ 5. Process      │
                                                                  │                 │
                                                                  └─────────────────┘
                                                                        │
                                                                        ▼
                                                                  ┌─────────────────┐
                                                                  │  Session Store  │
                                                                  │                 │
                                                                  │ 6. Session Ops  │
                                                                  │                 │
                                                                  └─────────────────┘
                                                                        │
                        ┌─────────────────┐    ┌─────────────────┐    │
                        │   Replication   │    │   Cache         │    ▼
                        │   Layer         │    │   Layer         │  ┌─────────────────┐
                        └─────────────────┘    └─────────────────┘  │  Database       │
                                                                    │                 │
                                                                    │ 7. Data Ops    │
                                                                    │                 │
                                                                    └─────────────────┘
```

## Failover Flow

```
Normal Operation:
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Primary       │    │   Secondary     │    │   Standby        │
│   Region        │    │   Region        │    │   Region        │
│                 │    │                 │    │                 │
│  100% Traffic   │◀───│  0% Traffic     │    │  0% Traffic     │
│   Active        │    │   Standby       │    │   Standby       │
└─────────────────┘    └─────────────────┘    └─────────────────┘

During Regional Failure:
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Primary       │    │   Secondary     │    │   Standby        │
│   Region        │    │   Region        │    │   Region        │
│                 │    │                 │    │                 │
│  0% Traffic     │    │  70% Traffic    │    │  30% Traffic     │
│   Failed        │    │   Active        │    │   Active        │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

## Monitoring Architecture

```
┌────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                          │
│  ┌──────────────────────────────────────────────────────────────────────────────────────┐ │
│  │                             Monitoring Stack                                         │ │
│  │                                                                                      │ │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐ │ │
│  │  │   Prometheus     │  │   Grafana       │  │   ELK Stack      │  │   AlertManager   │ │ │
│  │  │   Collector      │  │   Dashboards    │  │   Logs           │  │   Notifications  │ │ │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘  └─────────────────┘ │ │
│  │                        │                        │                        │             │ │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐ │ │
│  │  │   Metrics       │  │   Logs          │  │   Traces         │  │   Alerts        │ │ │
│  │  │   Endpoint       │  │   Shipper       │  │   Collector      │  │   Rules         │ │ │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘  └─────────────────┘ │ │
│  │                                                                                      │ │
│  │  ┌─────────────────────────────────────────────────────────────────────────────────┐ │ │
│  │  │                            HA Control Plane                                    │ │ │
│  │  │                                                                                 │ │ │
│  │  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐     │ │ │
│  │  │  │   Auto-       │  │   Failover   │  │   Scaling    │  │   Orchestration│ │ │
│  │  │  │   Healing     │  │   Manager    │  │   Manager    │  │   Manager    │     │ │ │
│  │  │  └──────────────┘  └──────────────┘  └──────────────┘  └──────────────┘     │ │ │
│  │  └─────────────────────────────────────────────────────────────────────────────────┘ │ │
│  └──────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                          │
└────────────────────────────────────────────────────────────────────────────────────────────┘
```

## Network Security Architecture

```
                      ┌─────────────────────────────────────────────────────────┐
                      │                      Internet                           │
                      │                                                        │
                      └─────────────────────┬─────────────────────────────────────┘
                                        │
                                        ▼
                      ┌─────────────────────────────────────────────────────────┐
                      │                   Firewall                              │
                      │                   (Network ACLs)                        │
                      └─────────────────────┬─────────────────────────────────────┘
                                        │
                                        ▼
                      ┌─────────────────────────────────────────────────────────┐
                      │                   VPN                                    │
                      │                  (Site-to-Site)                         │
                      └─────────────────────┬─────────────────────────────────────┘
                                        │
                                        ▼
                      ┌─────────────────────────────────────────────────────────┐
                      │                 VPC Boundary                            │
                      │                                                        │
                      └─────────────────────┬─────────────────────────────────────┘
                                        │
                      ┌─────────────────────┼─────────────────────────────────────┐
                      │                   │                                     │
                      ▼                   ▼                                     ▼
            ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
            │  Public Subnet  │    │  Private Subnet │    │ Database Subnet │
            │                 │    │                 │    │                 │
            │  Web Servers    │    │  Application    │    │  Database       │
            │  Load Balancers │    │  Servers        │    │  Servers        │
            │                 │    │                 │    │                 │
            └─────────────────┘    └─────────────────┘    └─────────────────┘
                      │                   │                                     │
                      └───────────────────┼───────────────────────────────────────┘
                                        │
                                        ▼
                      ┌─────────────────────────────────────────────────────────┐
                      │                   Security Groups                        │
                      │                   (Stateful Rules)                       │
                      └─────────────────────┬─────────────────────────────────────┘
                                        │
                                        ▼
                      ┌─────────────────────────────────────────────────────────┐
                      │                 Application Layer                       │
                      │                                                        │
                      └─────────────────────────────────────────────────────────┘
```

---

*These diagrams illustrate the multi-region high availability architecture for erlmcp v3.*
*Last Updated: February 2, 2026*