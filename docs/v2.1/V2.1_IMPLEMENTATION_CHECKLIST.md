# erlmcp v2.1 Implementation Checklist

**Status:** ACTIVE
**Created:** 2026-01-28
**Target:** 2026-03-15
**Priority:** By Impact × Effort

---

## Week 1: v2.0 Unblocking (2026-01-28 → 2026-02-03)

**Milestone:** v2.0.0 CERTIFIED ✓
**Effort:** 40 hours

### Critical Priority: Test Failures (32h)

#### TCPS Integration Tests (16h)
- [ ] Fix gen_server not running errors in tcps_quality_gates_SUITE
- [ ] Fix init_per_suite failures in TCPS integration tests
- [ ] Start tcps_erlmcp application before test execution
- [ ] Ensure gen_server processes properly registered
- [ ] Fix 93 actual CT failures (logic errors, noproc, badmatch)

#### Transport Behavior Tests (12h)
- [ ] Fix 24 failures in erlmcp_transport_behavior_SUITE
- [ ] Fix behavior validation issues
- [ ] Fix message format validation
- [ ] Verify all 6 transports (STDIO, TCP, HTTP, WS, SSE, GraphQL)

#### Regression Detection Tests (4h)
- [ ] Fix 4 badmatch errors in regression_detection_SUITE
- [ ] Fix severity classification logic
- [ ] Fix justification handling

### High Priority: EUnit Failures (8h)
- [ ] Investigate and fix EUnit test module failures
- [ ] Verify all EUnit suites pass
- [ ] Run: `rebar3 eunit --verbose`

### Validation
- [ ] Run: `make validate-test`
- [ ] Verify: 0 failures (278 → 0)
- [ ] Verify: 100% pass rate
- [ ] Run: `make validate-compile`
- [ ] Verify: 0 errors, 4 apps compiled

### Deliverables
- [ ] All tests passing (CT + EUnit)
- [ ] Quality gates: compile, test
- [ ] Git commit: "fix: resolve 278 CT failures for v2.0 certification"

---

## Week 2: v2.1 Core Features (2026-02-04 → 2026-02-10)

**Milestone:** V2.1 FEATURES VALIDATED ✓
**Effort:** 50 hours

### Connection Pooling (12h)

#### Runtime Integration (4h)
- [ ] Integrate erlmcp_pool_manager with transport layer
- [ ] Add pool lifecycle to erlmcp_transport_sup
- [ ] Configure pool strategies: FIFO, LIFO, round-robin
- [ ] Module: `apps/erlmcp_transports/src/erlmcp_pool_manager.erl`

#### Testing (3h)
- [ ] Create comprehensive pool lifecycle tests
- [ ] Test pool strategies (FIFO, LIFO, round-robin)
- [ ] Test pool utilization (10 → 1000 workers)
- [ ] Test pool_vs_no_pool scenarios

#### Benchmarking (2h)
- [ ] Run: `erlmcp_bench_pool:run(<<"pool_10_to_1000">>)`
- [ ] Run: `erlmcp_bench_pool:run(<<"pool_strategies">>)`
- [ ] Run: `erlmcp_bench_pool:run(<<"pool_utilization">>)`
- [ ] Run: `erlmcp_bench_pool:run(<<"pool_vs_no_pool">>)`
- [ ] Verify: 2x improvement for 100+ concurrent clients

#### Documentation (3h)
- [ ] Document pooling strategies
- [ ] Document configuration options
- [ ] Add pooling guide to README

### Request Batching (14h)

#### Executor Integration (4h)
- [ ] Integrate erlmcp_batch with client API
- [ ] Add batch executor to erlmcp_client
- [ ] Configure batch strategies: size-based, time-based, adaptive
- [ ] Module: `apps/erlmcp_core/src/erlmcp_batch.erl`

#### Testing (4h)
- [ ] Test batching strategies (size-based, time-based, adaptive)
- [ ] Test batch sizes: 10, 100, 1000
- [ ] Test batch timeout handling
- [ ] Test error propagation in batches

#### Benchmarking (2h)
- [ ] Run: `erlmcp_bench_batch:run(<<"batch_1k">>)`
- [ ] Run: `erlmcp_bench_batch:run(<<"batch_10k">>)`
- [ ] Run: `erlmcp_bench_batch:run(<<"batch_100k">>)`
- [ ] Verify: 2-5x improvement

#### Documentation (4h)
- [ ] Document batching patterns
- [ ] Document best practices
- [ ] Add batching guide to README

### Core Module Test Coverage (24h)

#### erlmcp_core Coverage (12h)
- [ ] erlmcp_client_tests.erl → lifecycle tests
- [ ] erlmcp_server_tests.erl → lifecycle tests
- [ ] erlmcp_registry_tests.erl → edge cases
- [ ] erlmcp_json_rpc_tests.erl → codec tests
- [ ] erlmcp_batch_tests.erl → comprehensive tests (NEW)
- [ ] erlmcp_cache_tests.erl → L1/L2/L3 tests (NEW)

#### erlmcp_transports Coverage (12h)
- [ ] erlmcp_transport_stdio_tests.erl → stdio tests
- [ ] erlmcp_transport_tcp_tests.erl → ranch tests
- [ ] erlmcp_transport_http_tests.erl → gun HTTP/2 tests
- [ ] erlmcp_transport_ws_tests.erl → WebSocket tests
- [ ] erlmcp_pool_manager_tests.erl → pool tests (NEW)

### Validation
- [ ] Run: `rebar3 eunit --verbose`
- [ ] Run: `rebar3 ct --verbose`
- [ ] Run: `rebar3 as test cover`
- [ ] Verify: Coverage 0% → 50%

### Deliverables
- [ ] Connection pooling: integrated + tested + benchmarked
- [ ] Request batching: integrated + tested + benchmarked
- [ ] Core module coverage: 50%
- [ ] Git commit: "feat: v2.1 connection pooling and request batching"

---

## Week 3: Coverage + Caching (2026-02-11 → 2026-02-17)

**Milestone:** 70% TEST COVERAGE ✓
**Effort:** 68 hours

### Multi-level Caching (16h)

#### Benchmark Creation (6h)
- [ ] Create: `bench/erlmcp_bench_cache.erl`
- [ ] Implement cache hit/miss scenarios
- [ ] Implement L1/L2/L3 cache tests
- [ ] Implement eviction strategy tests (LRU)

#### Benchmark Execution (2h)
- [ ] Run: `erlmcp_bench_cache:run(<<"cache_hit_rates">>)`
- [ ] Run: `erlmcp_bench_cache:run(<<"cache_l1_l2_l3">>)`
- [ ] Run: `erlmcp_bench_cache:run(<<"cache_eviction">>)`
- [ ] Verify: 10-100x improvement for cache hits

#### Testing (4h)
- [ ] Enhance erlmcp_cache_tests.erl
- [ ] Test L1 (ETS) cache
- [ ] Test L2 (Mnesia) cache
- [ ] Test L3 (External) cache
- [ ] Test eviction strategies

#### Documentation (4h)
- [ ] Document caching policies
- [ ] Document eviction strategies
- [ ] Add caching guide to README

### Transport + Observability Coverage (36h)

#### erlmcp_transports Completion (16h)
- [ ] erlmcp_transport_sse_tests.erl → SSE tests
- [ ] erlmcp_transport_graphql_tests.erl → GraphQL tests
- [ ] erlmcp_transport_pipeline_tests.erl → pipeline tests
- [ ] Edge cases and error handling

#### erlmcp_observability Coverage (16h)
- [ ] erlmcp_metrics_tests.erl → metrics tests
- [ ] erlmcp_otel_tests.erl → OTEL integration tests
- [ ] erlmcp_health_monitor_tests.erl → health check tests
- [ ] erlmcp_recovery_manager_tests.erl → recovery tests
- [ ] erlmcp_chaos_tests.erl → chaos tests

#### Integration Tests (4h)
- [ ] Cross-app integration scenarios
- [ ] End-to-end workflow tests
- [ ] Failure mode tests

### TCPS Integration Test Fixes (16h)

#### Critical Path Modules
- [ ] Fix tcps_quality_gates tests
- [ ] Fix tcps_work_order tests
- [ ] Fix tcps_kanban tests
- [ ] Fix tcps_sku tests
- [ ] Fix tcps_andon tests
- [ ] Ensure services running before tests

#### Test Infrastructure
- [ ] Fix Mnesia table initialization issues
- [ ] Fix test helper setup
- [ ] Fix ensure_dir badmatch errors
- [ ] Add proper teardown

### Validation
- [ ] Run: `rebar3 as test cover`
- [ ] Verify: Coverage 50% → 70%
- [ ] Run: `make validate-test`
- [ ] Verify: All tests passing

### Deliverables
- [ ] Multi-level caching: benchmarked + tested
- [ ] Transport coverage: complete
- [ ] Observability coverage: complete
- [ ] TCPS integration tests: fixed
- [ ] Coverage: 70%
- [ ] Git commit: "test: achieve 70% coverage with caching validation"

---

## Week 4: OTEL + Pipelines (2026-02-18 → 2026-02-24)

**Milestone:** ALL V2.1 FEATURES TESTED ✓
**Effort:** 58 hours

### Enhanced OTEL Testing (18h)

#### Exporter Tests (6h)
- [ ] Test Jaeger exporter
- [ ] Test Datadog exporter
- [ ] Test Honeycomb exporter
- [ ] Test exporter configuration
- [ ] Module: `apps/erlmcp_observability/src/erlmcp_otel_exporters.erl`

#### Trace Context Tests (4h)
- [ ] Test W3C trace context propagation
- [ ] Test span creation and correlation
- [ ] Test trace context injection
- [ ] Test cross-service tracing

#### Performance Overhead Validation (3h)
- [ ] Benchmark OTEL overhead
- [ ] Verify: <5% degradation (2.4M msg/sec min)
- [ ] Test with tracing enabled vs disabled

#### Documentation (5h)
- [ ] OTEL setup guide
- [ ] Exporter configuration guide
- [ ] Best practices for distributed tracing
- [ ] Troubleshooting guide

### Transport Pipeline Tests (16h)

#### HTTP/2 Pipeline Tests (5h)
- [ ] Test HTTP/2 multiplexing
- [ ] Test stream prioritization
- [ ] Test server push scenarios
- [ ] Test connection reuse

#### WebSocket Pipeline Tests (3h)
- [ ] Test WebSocket upgrade
- [ ] Test bidirectional streaming
- [ ] Test frame fragmentation
- [ ] Test connection lifecycle

#### Backpressure Tests (4h)
- [ ] Test flow control
- [ ] Test buffer management
- [ ] Test overload handling
- [ ] Test graceful degradation

#### Documentation (4h)
- [ ] Pipeline patterns guide
- [ ] Configuration options
- [ ] Performance tuning tips

### Coverage Completion (24h)

#### Remaining Modules (16h)
- [ ] Cover all modules with <80% coverage
- [ ] Add edge case tests
- [ ] Add error handling tests
- [ ] Add property-based tests (PropEr)

#### Integration Scenarios (8h)
- [ ] Multi-app integration tests
- [ ] Failure recovery tests
- [ ] Upgrade/downgrade tests
- [ ] Hot code reload tests

### Type Checking + Xref (8h)
- [ ] Run: `rebar3 dialyzer`
- [ ] Fix all dialyzer errors
- [ ] Run: `rebar3 xref`
- [ ] Fix all xref warnings

### Validation
- [ ] Run: `rebar3 as test cover`
- [ ] Verify: Coverage 70% → 80%
- [ ] Run: `make validate`
- [ ] Verify: All gates passing

### Deliverables
- [ ] Enhanced OTEL: tested + documented
- [ ] Transport pipelines: tested + documented
- [ ] Coverage: 80%
- [ ] Dialyzer: clean
- [ ] Xref: clean
- [ ] Git commit: "test: achieve 80% coverage with OTEL and pipeline validation"

---

## Week 5: Performance Validation (2026-02-25 → 2026-03-03)

**Milestone:** PERFORMANCE TARGETS MET ✓
**Effort:** 38 hours

### v2.1 Feature Benchmarks (16h)

#### Connection Pooling Benchmarks (4h)
- [ ] Run all pooling benchmarks
- [ ] Validate 2x improvement (5.0M msg/sec)
- [ ] Document performance characteristics
- [ ] Create performance report

#### Request Batching Benchmarks (4h)
- [ ] Run all batching benchmarks
- [ ] Validate 2-5x improvement (5-12M msg/sec)
- [ ] Document batching strategies performance
- [ ] Create performance report

#### Response Caching Benchmarks (4h)
- [ ] Run all caching benchmarks
- [ ] Validate 10-100x improvement (25-250M ops/sec)
- [ ] Document cache hit/miss characteristics
- [ ] Create performance report

#### OTEL Overhead Benchmarks (4h)
- [ ] Benchmark OTEL overhead
- [ ] Validate <5% degradation (2.4M msg/sec min)
- [ ] Document tracing overhead
- [ ] Create overhead report

### Stress + Chaos Testing (16h)

#### Stress Testing (8h)
- [ ] Run: `erlmcp_bench_stress:run(<<"stress_30s_10k_ops">>)`
- [ ] Run: `erlmcp_bench_stress:run(<<"stress_5min_100k_ops">>)`
- [ ] Run: `erlmcp_bench_stress:run(<<"stress_24hr_1M_ops">>)` (overnight)
- [ ] Validate: No memory leaks
- [ ] Validate: Sustained throughput
- [ ] Document: Stress test results

#### Chaos Engineering (8h)
- [ ] Run all 11 chaos scenarios
- [ ] Validate recovery <5s
- [ ] Document failure modes
- [ ] Document recovery patterns
- [ ] Create chaos report

### Regression Detection Automation (6h)

#### CI Integration (4h)
- [ ] Add benchmark execution to CI
- [ ] Add regression detection gates
- [ ] Configure failure thresholds (>10% fails PR)
- [ ] Add performance dashboard

#### Automation (2h)
- [ ] Automate baseline comparison
- [ ] Automate performance reports
- [ ] Configure weekly performance runs

### Validation
- [ ] Verify: <10% regression from v2.0 baseline
- [ ] Verify: All v2.1 features show improvements
- [ ] Verify: Stress tests passed
- [ ] Verify: Chaos tests passed (11/11)

### Deliverables
- [ ] All benchmarks complete (7 suites)
- [ ] Stress testing: passed
- [ ] Chaos engineering: passed (11/11)
- [ ] Regression gates: automated
- [ ] Performance baseline: documented
- [ ] Git commit: "perf: validate v2.1 performance targets"

---

## Week 6: Documentation + Release (2026-03-04 → 2026-03-15)

**Milestone:** V2.1.0 RELEASED ✓
**Effort:** 42 hours

### Architecture + API Documentation (18h)

#### Architecture Docs (10h)
- [ ] v2.1 feature architecture (pooling, batching, caching)
- [ ] Updated supervision tree diagrams
- [ ] Performance characteristics
- [ ] Update: `docs/architecture.md`

#### API Reference (8h)
- [ ] erlmcp_batch API reference
- [ ] erlmcp_cache API reference
- [ ] erlmcp_pool_manager API reference
- [ ] Enhanced OTEL API reference
- [ ] Add to: `docs/api-reference.md`

### Migration Guide (7h)

#### Migration Documentation (4h)
- [ ] v2.0 → v2.1 migration guide
- [ ] Breaking changes (if any)
- [ ] Configuration updates
- [ ] API additions
- [ ] File: `docs/MIGRATION_v2.0_to_v2.1.md`

#### Release Notes (3h)
- [ ] New features summary
- [ ] Performance improvements
- [ ] Bug fixes
- [ ] Known issues
- [ ] Upgrade instructions
- [ ] File: `RELEASE_NOTES_v2.1.0.md`

### User Guides (13h)

#### Pooling Guide (3h)
- [ ] Connection pooling concepts
- [ ] Configuration options
- [ ] Best practices
- [ ] File: `docs/guides/CONNECTION_POOLING.md`

#### Batching Guide (3h)
- [ ] Request batching concepts
- [ ] Batching strategies
- [ ] Best practices
- [ ] File: `docs/guides/REQUEST_BATCHING.md`

#### Caching Guide (3h)
- [ ] Multi-level caching concepts
- [ ] Eviction strategies
- [ ] Best practices
- [ ] File: `docs/guides/RESPONSE_CACHING.md`

#### Tuning Guide (4h)
- [ ] Performance tuning recommendations
- [ ] Configuration best practices
- [ ] Monitoring and profiling
- [ ] File: `docs/guides/PERFORMANCE_TUNING.md`

### Quality Gates Validation (4h)

#### Final Validation
- [ ] Run: `make validate`
- [ ] Verify: All 7 gates passing
  - [ ] Compilation: ✅ PASS
  - [ ] EUnit: ✅ PASS
  - [ ] Common Test: ✅ PASS
  - [ ] Coverage: ✅ ≥80%
  - [ ] Dialyzer: ✅ PASS
  - [ ] Xref: ✅ PASS
  - [ ] Benchmarks: ✅ PASS

#### Quality Receipt Generation
- [ ] Run: `./tools/tcps/generate-quality-receipt.sh`
- [ ] Verify: certified: true
- [ ] Verify: blocker_count: 0
- [ ] Verify: all_gates_passed: true
- [ ] Verify: SHA-256 hash generated
- [ ] File: `receipts/quality/$(git rev-parse HEAD).json`

### Release Process (4h)

#### Version Bump
- [ ] Update: `src/erlmcp.app.src` → v2.1.0
- [ ] Update: `apps/*/src/*.app.src` → v2.1.0
- [ ] Update: `rebar.config` release version
- [ ] Update: `CHANGELOG.md`

#### Git Release
- [ ] Git commit: "release: erlmcp v2.1.0"
- [ ] Git tag: `v2.1.0`
- [ ] Push tag: `git push origin v2.1.0`
- [ ] Create GitHub release

#### Artifacts
- [ ] Generate release build: `rebar3 as prod release`
- [ ] Generate tarball: `rebar3 as prod tar`
- [ ] Upload artifacts to GitHub release
- [ ] Publish to Hex.pm (optional)

### Validation
- [ ] Quality receipt: certified
- [ ] All documentation complete (95%+)
- [ ] All tests passing
- [ ] All benchmarks complete
- [ ] Git tag: v2.1.0

### Deliverables
- [ ] Architecture + API docs: complete
- [ ] Migration guide: published
- [ ] User guides: complete
- [ ] Release notes: published
- [ ] Quality receipt: certified
- [ ] Git tag: v2.1.0
- [ ] GitHub release: created

---

## Success Criteria

### Must Have (Blocking)
- [ ] All tests passing (100% pass rate)
- [ ] Coverage ≥80% (208+ modules)
- [ ] No dialyzer errors
- [ ] No xref warnings
- [ ] Quality receipt certified (blocker_count: 0)
- [ ] v2.1 features validated (pooling, batching, caching)

### Should Have (High Priority)
- [ ] Performance benchmarks complete (7 suites)
- [ ] Documentation complete (95%+)
- [ ] Migration guide available
- [ ] Release notes published

### Nice to Have (Optional)
- [ ] Stress testing (24hr) passed
- [ ] Chaos engineering (11/11) passed
- [ ] CI/CD automation complete

---

## Status Tracking

**Current Week:** Week 1 (v2.0 Unblocking)
**Progress:** 0% (not started)
**Blockers:** None
**Next Review:** 2026-02-03 (post-Week 1)

**Updates:**
- Weekly standup: Mondays 10:00 AM
- Daily progress: Slack #erlmcp-v2.1-release
- Escalations: Architecture team lead

---

## Quick Reference Commands

### Testing
```bash
# Compile
make validate-compile

# Run all tests
make validate-test

# Run coverage
rebar3 as test cover

# Run specific suite
rebar3 ct --suite=apps/erlmcp_core/test/MODULE_SUITE

# Run EUnit
rebar3 eunit --module=MODULE_tests --verbose
```

### Benchmarking
```bash
# Core operations
erlmcp_bench_core_ops:run(<<"core_ops_100k">>).

# Connection pooling
erlmcp_bench_pool:run_all().

# Request batching
erlmcp_bench_batch:run_all().

# Response caching
erlmcp_bench_cache:run_all().

# Full suite
./scripts/bench/run_all_benchmarks.sh
```

### Quality Gates
```bash
# Full validation
make validate

# Individual gates
make validate-compile
make validate-test
make validate-coverage

# Generate receipt
./tools/tcps/generate-quality-receipt.sh
cat receipts/quality/$(git rev-parse HEAD).json | jq .
```

---

**Checklist Owner:** Erlang OTP Architect
**Last Updated:** 2026-01-28
**Target Completion:** 2026-03-15
**Status:** ACTIVE
