%% Development Profile - Fast Feedback & Relaxed Limits
%% Use when: Local development, rapid iteration, debugging
%%
%% Characteristics:
%% - Debug logging enabled
%% - Relaxed rate limits (fast feedback)
%% - Long timeouts (easier debugging)
%% - Circuit breaker disabled (retry quickly)
%% - Reduced message size limits (catch issues early)
%% - High verbosity for troubleshooting

[
    {erlmcp, [
        %% Logging: DEBUG for maximum visibility
        {log_level, debug},

        %% Client: Relaxed limits for iteration
        {client_defaults, #{
            timeout => 30000,           % 30 seconds (vs 5 sec prod)
            strict_mode => false,
            max_pending_requests => 500 % Higher than prod
        }},

        %% Server: Permissive settings for testing
        {server_defaults, #{
            max_subscriptions_per_resource => 5000,  % Liberal for testing
            max_progress_tokens => 50000
        }},

        %% Message sizes: Relaxed for early detection
        {message_size_limits, #{
            default => 33554432,        % 32 MB (2x prod)
            http_body => 33554432,
            sse_event => 33554432,
            websocket => 33554432,
            tcp => 33554432,
            stdio => 33554432
        }},

        %% Transport: Long timeouts for debugging
        {transport_defaults, #{
            tcp => #{
                connect_timeout => 30000,  % 30 seconds
                keepalive => true,
                nodelay => true
            },
            http => #{
                connect_timeout => 30000,
                request_timeout => 120000, % 2 minutes
                max_connections => 500     % Liberal
            }
        }},

        %% HTTP Security: Relaxed for local dev
        {http_security, [
            {allowed_origins, ["*"]},   % Accept all in dev
            {session_timeout, 7200},     % 2 hours
            {require_https, false},
            {http_redirect_to_https, false}
        ]},

        %% HTTPS: Disabled in dev
        {https_config, [
            {enabled, false}
        ]},

        %% Rate limiting: Disabled for fast iteration
        {rate_limiting, #{
            max_messages_per_sec => 10000,
            max_connections_per_sec => 100,
            global_max_messages_per_sec => 100000,
            max_tool_calls_per_sec => 500,
            max_subscriptions_per_sec => 200,
            bucket_refill_interval_ms => 100,
            ddos_violation_threshold => 10000,
            ddos_block_duration_ms => 10000,
            enabled => false  % DISABLED for development
        }},

        %% Backpressure: Relaxed for testing
        {backpressure, #{
            max_messages_per_sec => 5000,
            burst_multiplier => 5.0,
            adaptive_enabled => false,
            latency_threshold_ms => 500,
            rate_reduction_percent => 5,
            queue_depth_threshold_percent => 95
        }},

        %% Circuit breaker: DISABLED for quick retries
        {circuit_breaker, #{
            enabled => false,  % Disabled in dev for fast iteration
            failure_threshold => 100,
            cool_down_time_ms => 5000,
            p95_latency_threshold_ms => 1000,
            error_rate_threshold_percent => 10.0,
            cpu_threshold_percent => 95,
            memory_threshold_percent => 95,
            recovery_timeout_ms => 10000,
            half_open_timeout_ms => 5000
        }},

        %% Queue limits: Relaxed for testing
        {queue_limits, #{
            max_messages => 10000,
            max_bytes => 524288000,     % 500 MB
            backpressure_action => refuse,
            enable_tenant_limits => false,
            cleanup_interval_ms => 60000
        }},

        %% Connection pool: Large for development
        {connection_pool_config, #{
            pool_count => 32,
            pool_size => 100,
            max_overflow => 50,
            auto_create_pools => true,
            checkout_timeout => 30000,
            worker_timeout => 60000
        }},

        %% Lifecycle: Liberal TTLs for testing
        {lifecycle_management, #{
            subscription_ttl_ms => 0,   % Disabled (no expiry in dev)
            task_ttl_ms => 0,
            max_subscriptions_per_server => 100000,
            cleanup_interval_ms => 300000,
            cleanup_batch_size => 10000
        }},

        %% Session replication: Disabled in dev
        {session_replication, [
            {enabled, false},
            {replica_nodes, []},
            {batch_size => 1000,
            {batch_timeout_ms, 100}
        ]}
    ]},

    {kernel, [
        {logger_level, debug},
        {logger, [
            {handler, default, logger_std_h, #{
                config => #{
                    type => standard_io,
                    sync_mode_qlen => 1,      % Sync immediately (slower but ensures logs)
                    drop_mode_qlen => unlimited,
                    flush_qlen => 0
                },
                formatter => {logger_formatter, #{
                    template => [time, " [", level, "] ", pid, " ", mfa, ":", line, " ", msg, "\n"],
                    time_offset => "",
                    time_designator => $T,
                    single_line => false,
                    max_size => 8192
                }},
                level => debug
            }}
        ]}
    ]},

    {sasl, [
        {sasl_error_logger, true},  % Enabled for debugging
        {errlog_type, all},
        {error_logger_format_depth, 30}
    ]}
].
