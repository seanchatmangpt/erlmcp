================================================================================
EUNIT TEST FAILURES - QUICK FIX GUIDE
================================================================================

This file provides line-by-line fixes for each failing test module.

================================================================================
FIX PATTERN: Add setup() function to each test module
================================================================================

Most failures are due to missing gen_server startup in test setup.
Add this pattern to each failing test module:

BEFORE:
-------
-module(erlmcp_xxx_tests).
-include_lib("eunit/include/eunit.hrl").

%% Test functions here...

AFTER:
------
-module(erlmcp_xxx_tests).
-include_lib("eunit/include/eunit.hrl").

%% Add this:
setup() ->
    {ok, _} = application:ensure_all_started(erlmcp_core),
    [].

cleanup(_) ->
    application:stop(erlmcp_core).

%% Then update test generators:
my_test_() ->
    {setup,
     fun setup/0,
     fun cleanup/1,
     [
      ?_test(actual_test())
     ]}.

================================================================================
MODULE-SPECIFIC FIXES
================================================================================

1. erlmcp_pagination_tests (17 failures)
   File: apps/erlmcp_core/test/erlmcp_pagination_tests.erl
   Line: Add setup() at top of module
   
   Fix:
   setup() ->
       {ok, Pid} = erlmcp_pagination:start_link(#{}),
       [{pid, Pid}].
   
   cleanup(Pid) ->
       gen_server:stop(Pid).

2. erlmcp_logging_tests (19 failures)
   File: apps/erlmcp_core/test/erlmcp_logging_tests.erl
   Line: Add setup() at top of module
   
   Fix:
   setup() ->
       {ok, Pid} = erlmcp_logging:start_link(#{}),
       [{pid, Pid}].
   
   cleanup(Pid) ->
       gen_server:stop(Pid).

3. erlmcp_connection_limiter_tests (all tests skipped)
   File: apps/erlmcp_core/test/erlmcp_connection_limiter_tests.erl
   Line: 47 in setup/0
   
   Fix:
   setup() ->
       {ok, _} = application:ensure_all_started(gproc),
       {ok, _} = application:ensure_all_started(erlmcp_core),
       [].

4. erlmcp_registry_tests (3 failures)
   File: apps/erlmcp_core/test/erlmcp_registry_tests.erl
   Line: In test generator functions
   
   Fix:
   setup() ->
       {ok, Pid} = erlmcp_registry:start_link(),
       [{pid, Pid}].
   
   cleanup(Pid) ->
       gen_server:stop(Pid).

5. erlmcp_session_manager_tests (3 failures)
   File: apps/erlmcp_core/test/erlmcp_session_manager_tests.erl
   
   Fix:
   setup() ->
       {ok, Pid} = erlmcp_session_manager:start_link(#{}),
       [{pid, Pid}].
   
   cleanup(Pid) ->
       gen_server:stop(Pid).

6. erlmcp_notification_handler_tests (3 failures)
   File: apps/erlmcp_core/test/erlmcp_notification_handler_tests.erl
   
   Fix:
   setup() ->
       {ok, Pid} = erlmcp_notification_handler_sup:start_link(),
       [{pid, Pid}].
   
   cleanup(Pid) ->
       supervisor:stop(Pid).

7. erlmcp_rate_limit_middleware_tests (3 failures)
   File: apps/erlmcp_core/test/erlmcp_rate_limit_middleware_tests.erl
   
   Fix:
   setup() ->
       {ok, Pid} = erlmcp_rate_limiter:start_link(#{}),
       [{pid, Pid}].
   
   cleanup(Pid) ->
       gen_server:stop(Pid).

8. erlmcp_progress_tests (2 failures)
   File: apps/erlmcp_core/test/erlmcp_progress_tests.erl
   Line: 95 in update_progress_with_increment/0
   
   Fix:
   setup() ->
       {ok, Pid} = erlmcp_progress:start_link(#{}),
       [{pid, Pid}].
   
   cleanup(Pid) ->
       gen_server:stop(Pid).

9. erlmcp_cache_tests (2 failures)
   File: apps/erlmcp_core/test/erlmcp_cache_tests.erl
   
   Fix:
   setup() ->
       {ok, Pid} = erlmcp_cache:start_link(#{}),
       [{pid, Pid}].
   
   cleanup(Pid) ->
       gen_server:stop(Pid).

10. erlmcp_auth_tests (1 failure)
    File: apps/erlmcp_core/test/erlmcp_auth_tests.erl
    
    Fix:
    setup() ->
        {ok, Pid} = erlmcp_auth:start_link(#{}),
        [{pid, Pid}].
    
    cleanup(Pid) ->
        gen_server:stop(Pid).

11. erlmcp_client_tests (1 failure)
    File: apps/erlmcp_core/test/erlmcp_client_tests.erl
    Line: 715 in batch_request_test
    
    Fix:
    setup() ->
        {ok, RegPid} = erlmcp_registry:start_link(),
        {ok, ClientPid} = erlmcp_client:start_link(#{}),
        [{reg_pid, RegPid}, {client_pid, ClientPid}].
    
    cleanup(Config) ->
        gen_server:stop(?config(client_pid, Config)),
        gen_server:stop(?config(reg_pid, Config)).

12. erlmcp_code_reload_tests (1 failure)
    File: apps/erlmcp_core/test/erlmcp_code_reload_tests.erl
    
    Fix:
    setup() ->
        {ok, Pid} = erlmcp_code_reload:start_link(#{}),
        [{pid, Pid}].
    
    cleanup(Pid) ->
        gen_server:stop(Pid).

13. erlmcp_memory_guard_tests (1 failure)
    File: apps/erlmcp_core/test/erlmcp_memory_guard_tests.erl
    
    Fix:
    setup() ->
        {ok, Pid} = erlmcp_memory_guard:start_link(#{}),
        [{pid, Pid}].
    
    cleanup(Pid) ->
        gen_server:stop(Pid).

14. erlmcp_sse_event_store_tests (1 failure)
    File: apps/erlmcp_transports/test/erlmcp_sse_event_store_tests.erl
    
    Fix:
    setup() ->
        {ok, Pid} = erlmcp_sse_event_store:start_link(#{}),
        [{pid, Pid}].
    
    cleanup(Pid) ->
        gen_server:stop(Pid).

================================================================================
ALTERNATIVE: USE CENTRALIZED TEST HELPER
================================================================================

Instead of fixing each module individually, create a helper:

File: apps/erlmcp_core/test/erlmcp_test_helper.erl

-module(erlmcp_test_helper).
-export([start_core_servers/0, stop_core_servers/0]).

start_core_servers() ->
    {ok, _} = application:ensure_all_started(erlmcp_core),
    {ok, _} = erlmcp_registry:start_link(),
    {ok, _} = erlmcp_pagination:start_link(),
    {ok, _} = erlmcp_logging:start_link(),
    {ok, _} = erlmcp_session_manager:start_link(),
    {ok, _} = erlmcp_cache:start_link(),
    {ok, _} = erlmcp_auth:start_link(),
    {ok, _} = erlmcp_rate_limiter:start_link(),
    ok.

stop_core_servers() ->
    application:stop(erlmcp_core).

Then in each test module:

setup() ->
    ok = erlmcp_test_helper:start_core_servers(),
    [].

cleanup(_) ->
    ok = erlmcp_test_helper:stop_core_servers().

================================================================================
VERIFY FIXES
================================================================================

After applying fixes, run:

TERM=dumb rebar3 as test eunit --dir apps/erlmcp_core/test

Expected output:
  Failed: 0. Skipped: 0. Passed: 861.

================================================================================
