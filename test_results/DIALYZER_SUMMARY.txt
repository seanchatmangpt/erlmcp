================================================================================
DIALYZER TYPE CHECKING SUMMARY
================================================================================
Date: 2026-01-29
Erlang/OTP: 27.3.4.2
Status: FAILED (166 warnings)

================================================================================
WARNING BREAKDOWN
================================================================================

Total Warnings:        166
Files Analyzed:        112
PLT Files:             369 (OTP + deps)

By Category:
  Pattern Matching:     62  (37.3%)  <-- FIXABLE
  Unknown Functions:    54  (32.5%)  <-- PLT CONFIG
  No Local Return:      38  (22.9%)  <-- MOSTLY OK
  Unused Functions:     10  (6.0%)   <-- CLEANUP
  Missing Functions:     2  (1.2%)   <-- BUGS

================================================================================
TOP 10 MODULES BY WARNING COUNT
================================================================================

Rank  Module                          Warnings  Primary Issue
----  ------                          --------  --------------
 1    erlmcp_transport_sse.erl            25    Cowboy API mismatch
 2    erlmcp_capabilities.erl             23    Error exits
 3    erlmcp_profiler.erl                 19    Missing PLT entries
 4    erlmcp_cache.erl                    14    Mnesia not in PLT
 5    erlmcp_tracing.erl                  12    Missing functions
 6    erlmcp_registry.erl                 11    Pattern gaps
 7    erlmcp_session.erl                   9    Pattern gaps
 8    erlmcp_server.erl                    8    Pattern gaps
 9    erlmcp_client.erl                    7    Dead code
10    erlmcp_transport_tcp.erl             6    Pattern gaps

================================================================================
CRITICAL ISSUES (IMMEDIATE ACTION REQUIRED)
================================================================================

[1] Cowboy 2.x API Mismatch (HIGH)
    File: apps/erlmcp_transports/src/erlmcp_transport_sse.erl
    Lines: 215, 367, 509
    Issue: Calling cowboy_req:stream_body/2 (old API)
    Fix: Use cowboy_req:stream_body(Data, nofin, Req)

[2] Missing Validation Modules (HIGH)
    Missing: erlmcp_http_header_validator
             erlmcp_tls_validation
             erlmcp_origin_validator
             erlmcp_refusal
    Impact: 7 warnings
    Action: Create modules or remove calls

[3] PLT Configuration (MEDIUM)
    Missing from PLT: mnesia (8 warnings)
                       os_mon (2 warnings)
                       profiling tools (19 warnings)
    Fix: Add to rebar.config:
         {plt_extra_apps, [mnesia, os_mon]}

================================================================================
QUICK WINS (EASY FIXES)
================================================================================

1. Update rebar.config dialyzer section:
   {dialyzer, [
       {plt_apps, all_deps},           % Change from top_level_deps
       {plt_extra_apps, [mnesia, os_mon]}
   ]}.

2. Fix Cowboy API calls (3 instances):
   Replace: cowboy_req:stream_body(Data, Req)
   With:    cowboy_req:stream_body(Data, nofin, Req)

3. Remove dead code (10 unused functions):
   erlmcp_transport_sse:format_sse_event/2
   erlmcp_transport_sse:format_sse_keepalive/0
   erlmcp_transport_sse:split_data_by_newline/1
   erlmcp_transport_sse:format_data_lines/1
   erlmcp_transport_sse:format_term/1
   (5 more in other modules)

Expected reduction: ~42 warnings (25%)

================================================================================
MEDIUM-TERM FIXES (1-2 SPRINTS)
================================================================================

4. Fix pattern match gaps (62 instances):
   Priority modules:
   - erlmcp_transport_tcp.erl (6 warnings)
   - erlmcp_connection_limiter.erl (2 warnings)
   - erlmcp_circuit_breaker.erl (2 warnings)
   - erlmcp_pool_manager.erl (1 warning)
   
   Pattern:
   case gen_server:call(Pid, Req) of
       {ok, Result} -> {ok, Result};
       {error, Reason} -> {error, Reason}
   end.

5. Refactor error exits (24 functions):
   Replace exit/1 with {error, Reason}
   Priority: erlmcp_capabilities.erl (8 functions)
             erlmcp_cache.erl (2 functions)

Expected reduction: ~86 warnings (52%)

================================================================================
LONG-TERM IMPROVEMENTS
================================================================================

6. Add type specifications:
   Goal: -spec on all exported functions
   Current: Minimal type specs
   Target: 80%+ spec coverage

7. Implement CI/CD check:
   - Add rebar3 dialyzer to GitHub Actions
   - Fail build if new warnings introduced
   - Track warning count trends

================================================================================
TARGETS
================================================================================

Current:  166 warnings
Target 1: 100 warnings  (40% reduction)  - Sprint 1
Target 2: 50 warnings   (70% reduction)  - Sprint 2
Target 3: <10 warnings  (94% reduction) - Sprint 3

Zero defects: Only acceptable warnings are gen_server init/1 and event loops

================================================================================
COMPLIANCE STATUS
================================================================================

Quality Gate              Status    Threshold    Actual
----------------          ------    ----------   ------
Compilation               PASS      0 errors      0 errors
Tests                     PASS      100% pass    100%
Coverage                  PASS      >=80%        >=80%
Dialyzer                  FAIL      <50          166  âŒ
Xref                      UNKNOWN   0 issues     Not run

OVERALL: FAIL - Dialyzer warnings must be reduced

================================================================================
OUTPUT FILES
================================================================================

Full Report:      test_results/DIALYZER_REPORT.md (401 lines, 11KB)
Raw Warnings:     _build/default/27.3.4.2.dialyzer_warnings (670 lines)
Summary:          test_results/DIALYZER_SUMMARY.txt (this file)

================================================================================
NEXT STEPS
================================================================================

[ ] 1. Update rebar.config with PLT fixes
[ ] 2. Fix Cowboy API calls in erlmcp_transport_sse.erl
[ ] 3. Create or remove validation module calls
[ ] 4. Fix pattern match gaps (start with top 10 modules)
[ ] 5. Remove dead code
[ ] 6. Add type specifications
[ ] 7. Re-run Dialyzer and verify improvement
[ ] 8. Establish CI/CD gate

Estimated effort: 2-3 sprints for full cleanup

================================================================================
END OF SUMMARY
================================================================================
