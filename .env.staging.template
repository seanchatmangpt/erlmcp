# ============================================================================
# Staging Environment Variables Template for erlmcp v3
# ============================================================================
# Copy this file to .env.staging and fill in the actual values
# DO NOT commit .env.staging to version control
#
# Usage:
#   cp .env.staging.template .env.staging
#   # Edit .env.staging with your staging environment settings
#   docker compose -f docker-compose.yml -f docker-compose.override.staging.yml --env-file .env.staging up

# ============================================================================
# APPLICATION SETTINGS
# ============================================================================
ERLMCP_ENV=staging
ERLMCP_VERSION=3.0.0
ERLMCP_IMAGE=ghcr.io/your-org/erlmcp:3.0.0-staging

# Node naming for staging cluster
ERLMCP_NODE_NAME=erlmcp_staging@${HOSTNAME}

# ============================================================================
# ERLANG/OTP DISTRIBUTION
# ============================================================================
# Use Docker secrets for secure cookie management
# Create secret: echo "secure-cookie" | docker secret create erlmcp-erlang-cookie -
ERLANG_COOKIE_FILE=/run/secrets/erlang.cookie

# Distribution settings
ERL_DIST_PORT=9100
ERL_DIST_PORT_MIN=9100
ERL_DIST_PORT_MAX=9200

# ============================================================================
# SERVER PORTS
# ============================================================================
ERLMCP_PORT=8080              # HTTP API
METRICS_PORT=9100             # Prometheus metrics
HEALTH_PORT=9090              # Health check endpoint

# ============================================================================
# LOGGING
# ============================================================================
ERLMCP_LOG_LEVEL=info

# ============================================================================
# DATABASE (PostgreSQL - Staging)
# ============================================================================
ERLMCP_DB_HOST=postgres-staging
ERLMCP_DB_PORT=5432
ERLMCP_DB_NAME=erlmcp_staging
ERLMCP_DB_USER=erlmcp
ERLMCP_DB_PASSWORD_FILE=/run/secrets/db_password
DB_SSL_MODE=require
DB_POOL_SIZE=15

# ============================================================================
# REDIS (Caching - Staging)
# ============================================================================
REDIS_ENABLED=true
REDIS_HOST=redis-staging
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD_FILE=/run/secrets/redis_password

# ============================================================================
# OPEN TELEMETRY
# ============================================================================
OTEL_ENABLED=true
OTEL_EXPORTER_OTLP_ENDPOINT=http://otel-collector.staging.svc.cluster.local:4317
OTEL_SERVICE_NAME=erlmcp-staging
OTEL_RESOURCE_ATTRIBUTES=deployment.environment=staging,service.version=3.0.0
OTEL_SAMPLING_RATE=0.1

# ============================================================================
# SECURITY (Staging - moderate restrictions)
# ============================================================================
JWT_SECRET_KEY_FILE=/run/secrets/jwt_secret
SESSION_TIMEOUT_SECS=7200
ALLOW_INSECURE_HTTP=false
TLS_ENABLED=true
ERLMCP_TLS_CERT_FILE=/run/secrets/tls.crt
ERLMCP_TLS_KEY_FILE=/run/secrets/tls.key
ERLMCP_TLS_CA_FILE=/run/secrets/tls-ca.crt

# ============================================================================
# FEATURE FLAGS
# ============================================================================
FEATURE_RATE_LIMITING=true
FEATURE_RATE_LIMIT_PER_SECOND=500
FEATURE_RATE_LIMIT_BURST=50
FEATURE_ASYNC_PROCESSING=true
FEATURE_WEBHOOK_DELIVERY=true
FEATURE_EXPERIMENTAL=true

# ============================================================================
# DEBUG OPTIONS
# ============================================================================
DEBUG_SQL_QUERIES=false
DEBUG_HEADERS=false
ENABLE_PROFILING=true
ENABLE_PPROF=false
ENABLE_DEBUG_ENDPOINTS=true

# ============================================================================
# RESOURCE LIMITS (Staging - moderate limits)
# ============================================================================
ERLMCP_CPU_LIMIT=2.0
ERLMCP_MEMORY_LIMIT=4G
ERLMCP_CPU_RESERVATION=0.5
ERLMCP_MEMORY_RESERVATION=1G
ERLMCP_PIDS_LIMIT=4096

# ============================================================================
# ERLANG VM SETTINGS
# ============================================================================
ERL_MAX_PORTS=65536
ERL_MAX_ETS_TABLES=50000
ERL_FULLSWEEP_AFTER=0

# ============================================================================
# MONITORING
# ============================================================================
PROMETHEUS_PORT=9090
GRAFANA_PORT=3000
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD_FILE=/run/secrets/grafana_password

# ============================================================================
# SERVICE DISCOVERY
# ============================================================================
SERVICE_MESH_ENABLED=true
CONSUL_ENABLED=false
ISTIO_ENABLED=true
ISTIO_NAMESPACE=erlmcp-staging

# ============================================================================
# CACHE SETTINGS
# ============================================================================
CACHE_TTL_SECS=1800
CACHE_MAX_SIZE=10000

# ============================================================================
# HEALTH CHECKS
# ============================================================================
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_PATH=/health
HEALTH_CHECK_INTERVAL_SECS=30

# ============================================================================
# ALERTING (Less aggressive than production)
# ============================================================================
ALERT_THRESHOLD_ERROR_RATE=0.05
ALERT_THRESHOLD_LATENCY_P99=2000
ALERT_THRESHOLD_MEMORY=0.85

# ============================================================================
# CLUSTER SETTINGS
# ============================================================================
ERLMCP_CLUSTER_ENABLED=true
ERLMCP_CLUSTER_AUTOCONNECT=true
ERLMCP_CLUSTER_DISCOVERY=swarm
ERLMCP_CLUSTER_HEARTBEAT_INTERVAL=10000
ERLMCP_CLUSTER_NODE_CLEANUP_INTERVAL=60000
ERLMCP_SPLIT_BRAIN_STRATEGY=majority
ERLMCP_SPLIT_BRAIN_CHECK_INTERVAL=30000

# ============================================================================
# SECRET REFERENCES (for documentation - actual secrets in Docker secrets)
# ============================================================================
# Create secrets with:
#   echo "your-staging-cookie" | docker secret create erlmcp-staging-erlang-cookie -
#   echo "your-staging-db-password" | docker secret create erlmcp-staging-db-password -
#   echo "your-staging-redis-password" | docker secret create erlmcp-staging-redis-password -
#   echo "your-staging-jwt-secret" | docker secret create erlmcp-staging-jwt-secret -
#   echo "your-staging-grafana-password" | docker secret create erlmcp-staging-grafana-password -
#   cat tls-staging.crt | docker secret create erlmcp-staging-tls-cert -
#   cat tls-staging.key | docker secret create erlmcp-staging-tls-key -
# ============================================================================
