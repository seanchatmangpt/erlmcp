================================================================================
ERLMCP CORE OPERATIONS BENCHMARK - QUICK START
================================================================================

MODULE: erlmcp_bench_core_ops.erl
LINES OF CODE: 459
TYPE SPECS: 17

--------------------------------------------------------------------------------
QUICK COMMANDS
--------------------------------------------------------------------------------

# Compile & Run All Workloads
rebar3 shell
> c("bench/erlmcp_bench_core_ops.erl").
> erlmcp_bench_core_ops:run_all().

# Run Single Workload
> erlmcp_bench_core_ops:run(<<"core_ops_100k">>).

# One-Shot CLI (100K Workload)
erl -noshell -pa _build/default/lib/*/ebin \
  -eval "compile:file(\"bench/erlmcp_bench_core_ops.erl\", [{outdir, \"bench/\"}, debug_info]), \
         code:add_path(\"bench\"), \
         erlmcp_bench_core_ops:run(<<\"core_ops_100k\">>), \
         timer:sleep(2000), \
         init:stop()."

--------------------------------------------------------------------------------
AVAILABLE WORKLOADS
--------------------------------------------------------------------------------

ID                 Operations    Workers    Duration (est)
--------------------------------------------------------------------------------
core_ops_1k        1,000         1          <0.1s
core_ops_10k       10,000        10         <0.5s
core_ops_100k      100,000       100        ~0.15s
core_ops_1m        1,000,000     100        ~2-3s

--------------------------------------------------------------------------------
OUTPUT LOCATION
--------------------------------------------------------------------------------

bench/results/core_ops_<workload_id>_<timestamp>.json

Example:
bench/results/core_ops_core_ops_100k_1769567361.json

--------------------------------------------------------------------------------
METROLOGY FIELDS (Guaranteed)
--------------------------------------------------------------------------------

✓ workload_id           - Workload identifier
✓ benchmark             - "core_operations"
✓ timestamp             - Unix timestamp (seconds)
✓ operations            - Total operations (4 × workload ops)
✓ duration_s            - Duration in seconds
✓ throughput_msg_per_s  - Operations per second
✓ latency_p50_us        - 50th percentile latency (μs)
✓ latency_p95_us        - 95th percentile latency (μs)
✓ latency_p99_us        - 99th percentile latency (μs)
✓ precision             - "microsecond"
✓ memory_start_mib      - Memory before (MiB)
✓ memory_end_mib        - Memory after (MiB)
✓ memory_delta_mib      - Memory change (MiB)
✓ cpu_percent_avg       - Average CPU usage (%)
✓ scope                 - "per_node"
✓ environment           - {hostname, erlang_version, os, os_version}
✓ components            - {registry, queue, pool, session}

--------------------------------------------------------------------------------
BENCHMARK COMPONENTS
--------------------------------------------------------------------------------

1. REGISTRY (erlang:put/get/erase)
   - Operations: put + get + delete cycle
   - Concurrency: Per worker

2. QUEUE (queue:in/out)
   - Operations: enqueue + dequeue cycle
   - Data Structure: Erlang queue module

3. POOL (ETS checkout/checkin)
   - Operations: checkout + work + checkin
   - Pool Size: 10 workers

4. SESSION (ETS concurrent get/put)
   - Operations: insert + lookup
   - Concurrency: {write_concurrency, true}

--------------------------------------------------------------------------------
TYPICAL RESULTS (OTP-27, Darwin 25.2.0, Apple Silicon)
--------------------------------------------------------------------------------

100K Workload:
  Throughput:    2.69M ops/sec
  Latency (p95): 83 μs
  Memory Delta:  +19.1 MiB
  Duration:      0.15s

Component Breakdown:
  Registry p95:  97 μs  (highest latency - process dict)
  Queue p95:     1 μs   (fastest - in-memory queue)
  Pool p95:      1 μs   (fast - ETS lookup)
  Session p95:   20 μs  (moderate - concurrent ETS)

--------------------------------------------------------------------------------
VALIDATION
--------------------------------------------------------------------------------

All reports validated before writing:
  ✓ Required fields present
  ✓ Environment captured
  ✓ Component metrics complete
  ✓ Numeric values valid

On failure:
  ✗ Error printed to console
  ✗ File not written
  ✗ Returns {error, {validation_failed, Reason}}

--------------------------------------------------------------------------------
QUALITY GATES (Production)
--------------------------------------------------------------------------------

Throughput:     ≥ 2M ops/sec (100K workload)
Latency p95:    ≤ 100 μs
Latency p99:    ≤ 150 μs
Memory Delta:   ≤ 50 MiB
CPU Usage:      30-80% (indicates good parallelism)

--------------------------------------------------------------------------------
TROUBLESHOOTING
--------------------------------------------------------------------------------

Q: High session latency (p99 > 1000 μs)?
A: ETS contention. Reduce worker count or shard tables.

Q: Memory delta keeps increasing?
A: Process dictionary not cleaned. Restart Erlang node.

Q: Low CPU usage (<30%)?
A: Insufficient workers. Increase worker count.

Q: Compilation errors?
A: Ensure jsx available: rebar3 deps

--------------------------------------------------------------------------------
API REFERENCE
--------------------------------------------------------------------------------

erlmcp_bench_core_ops:run()           % Run all workloads
erlmcp_bench_core_ops:run_all()       % Run all workloads (explicit)
erlmcp_bench_core_ops:run(WorkloadId) % Run specific workload
erlmcp_bench_core_ops:workloads()     % List available workloads

erlmcp_bench_core_ops:benchmark_registry(Workload)  % Run registry only
erlmcp_bench_core_ops:benchmark_queue(Workload)     % Run queue only
erlmcp_bench_core_ops:benchmark_pool(Workload)      % Run pool only
erlmcp_bench_core_ops:benchmark_session(Workload)   % Run session only

--------------------------------------------------------------------------------
FILES
--------------------------------------------------------------------------------

bench/erlmcp_bench_core_ops.erl    - Main benchmark module (459 LOC)
bench/CORE_OPS_README.md           - Full documentation
bench/QUICK_START_CORE_OPS.txt     - This file
bench/results/*.json               - Benchmark results

================================================================================
Last Updated: 2026-01-27 | Erlang/OTP 27 | Version 1.0.0
================================================================================
