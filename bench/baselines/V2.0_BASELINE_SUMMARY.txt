================================================================================
erlmcp v2.0.0 Performance Baseline - Executive Summary
================================================================================

Date:        January 28, 2026
Version:     v2.0.0
Baseline:    bench/baselines/2026-01-28_v2.0.0.json
Environment: macOS Darwin 25.2.0, OTP-27, ERTS 15.2.7.1, 8 cores

--------------------------------------------------------------------------------
BASELINE ESTABLISHED: APPROVED ✓
--------------------------------------------------------------------------------

PRIMARY METRICS (core_ops_100k):
  Throughput:     2,748,291 msg/s
  Latency P95:    83 µs
  Latency P99:    98 µs
  Memory Delta:   21.9 MiB
  CPU Average:    48%

COMPARISON TO v1 (v0.7.0):
  Throughput:     +2.2% (improvement)
  Latency P95:    0.0% (maintained)
  Latency P99:    0.0% (maintained)
  Memory:         +14.7% (acceptable)

REGRESSION THRESHOLDS:
  Throughput:     -10% (min: 2,473,462 msg/s)
  Latency P95:    +10% (max: 91.3 µs)
  Latency P99:    +10% (max: 107.8 µs)
  Memory Delta:   +20% (max: 26.3 MiB)

--------------------------------------------------------------------------------
BENCHMARK SUITE COVERAGE
--------------------------------------------------------------------------------

✓ COMPLETED:
  - Core Operations (4 workloads: 1K, 10K, 100K, 1M)
    - Registry, Queue, Pool, Session components
    - Throughput: 1.4M - 2.8M msg/s
    - Latency P99: 97-99 µs
    - Memory: Linear scaling (0.2 - 284.6 MiB)

⚠ PENDING (4/5 suites):
  - Network Real (TCP/HTTP transports)
  - Stress (sustained load: 30s, 5min, 30min, 24hr)
  - Chaos (11 failure scenarios)
  - Integration (5 MCP protocol workflows)

  Status: Pending transport module updates

--------------------------------------------------------------------------------
KEY FINDINGS
--------------------------------------------------------------------------------

1. PERFORMANCE STABILITY ✓
   - No critical regressions vs v1
   - Throughput improved +2.2%
   - Latency characteristics maintained
   - Memory increase acceptable for v2.0 refactoring

2. COMPONENT PERFORMANCE
   - Queue:     <1 µs avg (fastest)
   - Pool:      <1 µs avg (very fast)
   - Session:   0.3-7.5 µs avg (scales with load)
   - Registry:  ~51.5 µs avg (BOTTLENECK)

3. SCALABILITY PROFILE
   - Peak at 10K ops:    2.83M msg/s
   - Production (100K):  2.75M msg/s
   - Sustained (1M):     1.81M msg/s (GC overhead expected)

4. BOTTLENECK IDENTIFIED
   - Registry: 51.5 µs average latency (consistent across scales)
   - Optimization target: <30 µs (would yield +15% throughput)

5. TAIL LATENCY SPIKES
   - Session max: 18.7 ms at 1M ops
   - Cause: Likely GC or mailbox overflow
   - Mitigation: Process pooling or backpressure

--------------------------------------------------------------------------------
RECOMMENDATIONS
--------------------------------------------------------------------------------

ACCEPT v2.0 Baseline ✓
  - Core operations performance acceptable
  - No blocking regressions
  - Throughput improved over v1
  - Latency maintained

MONITOR in v2.1
  1. Memory usage (+15% trend)
  2. Session tail latency (18.7ms spikes)
  3. Registry optimization (<30µs target)

FUTURE OPTIMIZATIONS
  1. Registry: ETS caching or indexing
  2. Session: Backpressure or process pooling
  3. Memory: Profile allocation patterns at scale

COMPLETE BENCHMARK COVERAGE
  - Fix transport module interfaces
  - Establish Network/Stress/Chaos/Integration baselines
  - Required for full regression detection

--------------------------------------------------------------------------------
FILES GENERATED
--------------------------------------------------------------------------------

Baseline Data:
  bench/baselines/2026-01-28_v2.0.0.json

Documentation:
  bench/baselines/V2.0.0_BASELINE_REPORT.md (comprehensive report)
  bench/baselines/V2.0_VS_V1_COMPARISON.md (v1 comparison)
  bench/baselines/V2.0_BASELINE_SUMMARY.txt (this file)

Result Files:
  bench/results/core_ops_core_ops_1k_1769631037.json
  bench/results/core_ops_core_ops_10k_1769631037.json
  bench/results/core_ops_core_ops_100k_1769630984.json
  bench/results/core_ops_core_ops_1m_1769631041.json

--------------------------------------------------------------------------------
USAGE INSTRUCTIONS
--------------------------------------------------------------------------------

Regression Detection (CI/CD):
  ./scripts/bench/compare_to_baseline.sh
  # Exits 1 if regression detected (>10% slower, >20% more memory)

Update Baseline (After Optimization):
  ./scripts/bench/set_baseline.sh
  # Interactive update with justification

Manual Benchmark Run:
  erl -pa bench -pa _build/test/lib/*/ebin -noshell -eval "
      erlmcp_bench_core_ops:run(<<\"core_ops_100k\">>),
      halt(0).
  "

Compare to Baseline:
  diff bench/results/core_ops_core_ops_100k_*.json \
       bench/baselines/2026-01-28_v2.0.0.json

--------------------------------------------------------------------------------
CHANGE HISTORY
--------------------------------------------------------------------------------

v2.0.0 (2026-01-28):
  - Initial v2.0 baseline established
  - Core operations: 4 workloads (1K, 10K, 100K, 1M)
  - Throughput: 2.75M msg/s (core_ops_100k)
  - Latency P95: 83 µs, P99: 98 µs
  - Memory delta: 21.9 MiB
  - Status: APPROVED

v1.0/v0.7.0 (2026-01-27):
  - Previous baseline (BASELINE_EXAMPLE.json)
  - Throughput: 2.69M msg/s
  - Latency P95: 83 µs, P99: 98 µs
  - Memory delta: 19.1 MiB

--------------------------------------------------------------------------------
STATUS: BASELINE ESTABLISHED ✓
--------------------------------------------------------------------------------

Next Review: v2.1 release (monitor memory trend)
Engineer: Claude Sonnet 4.5 (erlang-performance agent)

================================================================================
