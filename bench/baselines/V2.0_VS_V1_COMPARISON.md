# erlmcp v2.0 vs v1 Performance Comparison

**Comparison Date:** January 28, 2026  
**v2.0 Baseline:** `2026-01-28_v2.0.0.json`  
**v1 Baseline:** `BASELINE_EXAMPLE.json` (v0.7.0)

---

## Summary

erlmcp v2.0 shows **stable performance** compared to v1 (v0.7.0), with slight improvements in throughput and maintained latency characteristics.

### Overall Verdict: PASS ✓

- Throughput: +2.2% improvement
- Latency: No regression (maintained)
- Memory: +14.7% increase (acceptable for refactoring)

---

## Detailed Comparison

### Throughput (core_ops_100k)

| Metric | v1 (v0.7.0) | v2.0 | Delta | Status |
|--------|-------------|------|-------|--------|
| **Throughput** | 2,690,088 msg/s | 2,748,291 msg/s | **+2.2%** | ✓ IMPROVEMENT |
| Operations | 400,000 | 400,000 | 0% | - |
| Duration | ~0.15s | 0.15s | 0% | - |

**Analysis:** v2.0 shows marginal throughput improvement over v1, indicating that refactoring did not introduce performance regressions.

---

### Latency (core_ops_100k)

| Percentile | v1 (v0.7.0) | v2.0 | Delta | Status |
|------------|-------------|------|-------|--------|
| **P50** | 0.0 µs | 0.0 µs | 0.0% | ✓ MAINTAINED |
| **P95** | 83.0 µs | 83.0 µs | 0.0% | ✓ MAINTAINED |
| **P99** | 98.0 µs | 98.0 µs | 0.0% | ✓ MAINTAINED |

**Analysis:** Latency characteristics identical between versions. No degradation in user-facing response times.

---

### Memory (core_ops_100k)

| Metric | v1 (v0.7.0) | v2.0 | Delta | Status |
|--------|-------------|------|-------|--------|
| **Memory Delta** | 19.1 MiB | 21.9 MiB | **+14.7%** | ⚠️ ACCEPTABLE |
| Memory per op | ~48 bytes | ~55 bytes | +14.6% | ⚠️ MONITOR |

**Analysis:** 15% memory increase acceptable given v2.0 refactoring. No evidence of memory leaks. Recommend monitoring in v2.1 to ensure stability.

---

## Component-Level Comparison

### Registry Performance
| Metric | v1 | v2.0 | Delta |
|--------|----|----- |-------|
| Avg Latency | ~51µs | 51.5µs | +1.0% |
| P95 Latency | ~96µs | 96µs | 0.0% |
| P99 Latency | ~98µs | 101µs | +3.1% |

**Stable.** Registry remains the bottleneck at ~51.5µs average latency.

### Queue Performance
| Metric | v1 | v2.0 | Delta |
|--------|----|----- |-------|
| Avg Latency | ~0.1µs | 0.1µs | 0.0% |
| P99 Latency | ~1µs | 1µs | 0.0% |

**Stable.** Queue maintains sub-microsecond performance.

### Pool Performance
| Metric | v1 | v2.0 | Delta |
|--------|----|----- |-------|
| Avg Latency | ~0.5µs | 0.4µs | -20.0% |
| P99 Latency | ~1µs | 1µs | 0.0% |

**Improved.** Pool shows 20% latency reduction in v2.0.

### Session Performance
| Metric | v1 | v2.0 | Delta |
|--------|----|----- |-------|
| Avg Latency | ~7µs | 7.5µs | +7.1% |
| P95 Latency | ~15µs | 15µs | 0.0% |
| P99 Latency | ~86µs | 86µs | 0.0% |

**Stable.** Session latency within acceptable variance.

---

## Regression Analysis

### No Critical Regressions Detected

All metrics fall within acceptable thresholds:

| Metric | Threshold | v2.0 Delta | Result |
|--------|-----------|------------|--------|
| Throughput | -10% | **+2.2%** | ✓ PASS |
| Latency P95 | +10% | **0.0%** | ✓ PASS |
| Latency P99 | +10% | **0.0%** | ✓ PASS |
| Memory | +20% | **+14.7%** | ✓ PASS |

---

## New Capabilities in v2.0

### Benchmark Suite Enhancements
- **4 core workloads:** 1K, 10K, 100K, 1M operations
- **Per-component metrics:** Registry, Queue, Pool, Session
- **Enhanced telemetry:** CPU%, memory tracking, max latencies
- **Metrology compliance:** Standardized units (µs, MiB, msg/s)

### Scalability Testing
v2.0 introduces sustained load testing:
- **core_ops_1m:** 1M operations over 2.21s
- **Memory profiling:** Linear growth tracking (~71 bytes/op)
- **Tail latency analysis:** Max latency spikes identified (18.7ms)

---

## Key Findings

### 1. v2.0 Refactoring Impact: Minimal
- No performance regressions introduced
- Slight throughput improvement (+2.2%)
- Memory increase acceptable for architectural changes

### 2. Bottleneck Consistency
- Registry remains primary bottleneck (~51.5µs)
- Opportunity for 15% throughput gain if optimized to <30µs

### 3. Scalability Profile
- Peak performance at 10K ops (2.83M msg/s)
- Sustained load at 1M ops (1.81M msg/s, 34% reduction)
- GC overhead becomes significant at scale

### 4. Memory Behavior
- Linear memory growth (~71 bytes/op at 1M scale)
- No evidence of leaks
- 15% increase vs v1 acceptable for v2.0

---

## Recommendations

### Accept v2.0 Baseline ✓
- Performance characteristics acceptable
- No blocking regressions
- Throughput improved over v1
- Latency maintained

### Monitor in v2.1
1. **Memory usage:** Track 15% increase trend
2. **Session tail latency:** Investigate 18.7ms spikes
3. **Registry optimization:** Target <30µs for 15% gain

### Future Optimizations
1. **Registry:** Investigate ETS caching or indexing
2. **Session:** Add backpressure or process pooling
3. **Memory:** Profile allocation patterns at scale

---

## Conclusion

erlmcp v2.0 demonstrates **stable performance** compared to v1, with no critical regressions and marginal improvements in throughput. The 15% memory increase is acceptable given architectural refactoring in v2.0.

**Recommendation:** Accept v2.0 baseline and use for regression detection in future releases.

---

**Report Generated:** 2026-01-28  
**Status:** APPROVED - v2.0 baseline accepted
**Next Review:** v2.1 release (monitor memory trend)
