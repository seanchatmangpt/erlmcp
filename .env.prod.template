# ============================================================================
# Production Environment Variables Template for erlmcp v3
# ============================================================================
# Copy this file to .env.prod and fill in the actual values
# DO NOT commit .env.prod to version control
#
# Usage:
#   cp .env.prod.template .env.prod
#   # Edit .env.prod with your production settings
#   docker stack deploy -c docker-compose.yml -c docker-compose.override.prod.yml --env-file .env.prod erlmcp
#
# SECURITY WARNING:
# - All secrets MUST be externalized using Docker secrets or Vault
# - NEVER commit actual values to version control
# - Use strong, randomly generated values for all secrets
# - Rotate credentials regularly

# ============================================================================
# APPLICATION SETTINGS
# ============================================================================
ERLMCP_ENV=production
ERLMCP_VERSION=3.0.0
ERLMCP_IMAGE=ghcr.io/your-org/erlmcp:3.0.0
ERLMCP_REPLICAS=5

# Node naming - Docker Swarm will use service_name.slot_id
ERLMCP_NODE_NAME=erlmcp@${HOSTNAME}

# ============================================================================
# ERLANG/OTP DISTRIBUTION (REQUIRED - SECURITY CRITICAL)
# ============================================================================
# CRITICAL: Generate secure cookie with: openssl rand -base64 48 | tr -d '\n'
# NEVER use default values - always set explicitly in production
# Store as Docker secret, not environment variable
ERLANG_COOKIE_FILE=/run/secrets/erlang.cookie

# Distribution settings for multi-host clustering
ERL_AFLAGS=-proto_dist inet_tls
ERL_DIST_PORT=9100
ERL_DIST_PORT_MIN=9100
ERL_DIST_PORT_MAX=9200

# ============================================================================
# SERVER PORTS
# ============================================================================
ERLMCP_PORT=8080              # HTTP API
METRICS_PORT=9100             # Prometheus metrics
HEALTH_PORT=9090              # Health check endpoint

# ============================================================================
# LOGGING
# ============================================================================
ERLMCP_LOG_LEVEL=warn
ERLMCP_LOG_FILE=/var/log/erlmcp/erlmcp.log

# ============================================================================
# DATABASE (PostgreSQL - Production)
# ============================================================================
# Use Docker secrets for ALL credentials
ERLMCP_DB_HOST=${DB_HOST:-postgres-prod}
ERLMCP_DB_PORT=5432
ERLMCP_DB_NAME=erlmcp_prod
ERLMCP_DB_USER=erlmcp
ERLMCP_DB_PASSWORD_FILE=/run/secrets/db_password
DB_SSL_MODE=require
DB_POOL_SIZE=25
DB_MAX_LIFETIME_SECS=600
DB_IDLE_TIMEOUT_SECS=300

# ============================================================================
# REDIS (Caching and Sessions - Production)
# ============================================================================
REDIS_ENABLED=true
REDIS_HOST=${REDIS_HOST:-redis-prod}
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD_FILE=/run/secrets/redis_password
REDIS_CLUSTER_ENABLED=true
REDIS_CLUSTER_NODES=3
REDIS_SENTINEL_ENABLED=true

# ============================================================================
# OPEN TELEMETRY
# ============================================================================
OTEL_ENABLED=true
OTEL_EXPORTER_OTLP_ENDPOINT=https://otel-collector.prod.svc.cluster.local:4317
OTEL_EXPORTER_OTLP_CERTIFICATE=/run/secrets/otel/ca.crt
OTEL_SERVICE_NAME=erlmcp
OTEL_RESOURCE_ATTRIBUTES=deployment.environment=production,service.version=3.0.0
OTEL_SAMPLING_RATE=0.01

# ============================================================================
# SECURITY (Production - strict restrictions)
# ============================================================================
# JWT Configuration - use RS256 for production
JWT_ALGORITHM=RS256
JWT_PRIVATE_KEY_PATH=/run/secrets/keys/jwt-private.pem
JWT_PUBLIC_KEY_PATH=/run/secrets/keys/jwt-public.pem

# Session Configuration
SESSION_TIMEOUT_SECS=1800
ALLOW_INSECURE_HTTP=false

# TLS Configuration - REQUIRED for production
TLS_ENABLED=true
ERLMCP_TLS_CERT_FILE=/run/secrets/tls.crt
ERLMCP_TLS_KEY_FILE=/run/secrets/tls.key
ERLMCP_TLS_CA_FILE=/run/secrets/tls-ca.crt
TLS_VERIFY=verify_peer
TLS_FAIL_IF_NO_PEER_CERT=true

# Rate Limiting
RATE_LIMIT_ENABLED=true
RATE_LIMIT_PER_SECOND=1000
RATE_LIMIT_BURST=100

# ============================================================================
# FEATURE FLAGS
# ============================================================================
FEATURE_RATE_LIMITING=true
FEATURE_ASYNC_PROCESSING=true
FEATURE_WEBHOOK_DELIVERY=true
FEATURE_EXPERIMENTAL=false

# ============================================================================
# DEBUG OPTIONS (ALL DISABLED IN PRODUCTION)
# ============================================================================
DEBUG_SQL_QUERIES=false
DEBUG_HEADERS=false
ENABLE_PROFILING=false
ENABLE_PPROF=false
ENABLE_DEBUG_ENDPOINTS=false

# ============================================================================
# RESOURCE LIMITS (Production - high limits)
# ============================================================================
ERLMCP_CPU_LIMIT=2.0
ERLMCP_MEMORY_LIMIT=4G
ERLMCP_CPU_RESERVATION=0.5
ERLMCP_MEMORY_RESERVATION=1G
ERLMCP_PIDS_LIMIT=4096

# ============================================================================
# ERLANG VM SETTINGS
# ============================================================================
ERL_MAX_PORTS=65536
ERL_MAX_ETS_TABLES=50000
ERL_FULLSWEEP_AFTER=0

# Connection pooling
ERLMCP_POOL_SIZE=50
ERLMCP_POOL_MAX_OVERFLOW=25
ERLMCP_POOL_TIMEOUT=30000

# Session settings
ERLMCP_SESSION_TIMEOUT=3600000
ERLMCP_MAX_SUBSCRIPTIONS=1000
ERLMCP_MAX_PROGRESS_TOKENS=10000

# ============================================================================
# MONITORING
# ============================================================================
PROMETHEUS_ENABLED=true
PROMETHEUS_LISTEN_ADDR=0.0.0.0:9090
PROMETHEUS_PUSH_GATEWAY_URL=http://prometheus-pushgateway:9091

GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD_FILE=/run/secrets/grafana_password

# ============================================================================
# SERVICE DISCOVERY
# ============================================================================
SERVICE_MESH_ENABLED=true
CONSUL_ENABLED=false
ISTIO_ENABLED=true
ISTIO_NAMESPACE=erlmcp-prod

# ============================================================================
# CACHE SETTINGS
# ============================================================================
CACHE_TTL_SECS=3600
CACHE_MAX_SIZE=100000

# ============================================================================
# HEALTH CHECKS
# ============================================================================
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_PATH=/health
HEALTH_CHECK_INTERVAL_SECS=10

# ============================================================================
# ALERTING (Strict thresholds for production)
# ============================================================================
ALERT_THRESHOLD_ERROR_RATE=0.001
ALERT_THRESHOLD_LATENCY_P99=500
ALERT_THRESHOLD_LATENCY_P999=1000
ALERT_THRESHOLD_MEMORY=0.75
ALERT_THRESHOLD_CPU=0.70
ALERT_THRESHOLD_GC_PAUSE=100

# ============================================================================
# CLUSTER SETTINGS
# ============================================================================
ERLMCP_CLUSTER_ENABLED=true
ERLMCP_CLUSTER_AUTOCONNECT=true
ERLMCP_CLUSTER_DISCOVERY=swarm
ERLMCP_CLUSTER_HEARTBEAT_INTERVAL=10000
ERLMCP_CLUSTER_NODE_CLEANUP_INTERVAL=60000
ERLMCP_SPLIT_BRAIN_STRATEGY=majority
ERLMCP_SPLIT_BRAIN_CHECK_INTERVAL=30000

# ============================================================================
# BACKUP & RECOVERY
# ============================================================================
BACKUP_ENABLED=true
BACKUP_FREQUENCY=HOURLY
BACKUP_RETENTION_DAYS=30
BACKUP_LOCATION=${BACKUP_LOCATION:-gs://erlmcp-prod-backups}
BACKUP_ENCRYPTION_KEY_FILE=/run/secrets/backup_encryption_key

# ============================================================================
# DISASTER RECOVERY
# ============================================================================
DR_ENABLED=true
DR_FAILOVER_ENABLED=true
DR_REPLICA_REGION=${DR_REPLICA_REGION:-us-east1}
DR_REPLICA_PROJECT=${DR_REPLICA_PROJECT:-erlmcp-prod-dr}

# ============================================================================
# COMPLIANCE & AUDIT
# ============================================================================
COMPLIANCE_MODE=true
AUDIT_LOG_ENABLED=true
AUDIT_LOG_DESTINATION=${AUDIT_LOG_DESTINATION:-gs://erlmcp-prod-audit-logs}
AUDIT_LOG_RETENTION_DAYS=365
PII_DATA_MASKING=true

# ============================================================================
# VERSION PINNING
# ============================================================================
APP_VERSION=${APP_VERSION:-3.0.0}
COMMIT_SHA=${COMMIT_SHA:-unknown}
BUILD_TIMESTAMP=${BUILD_TIMESTAMP:-}

# ============================================================================
# SECRET REFERENCES (for documentation - actual secrets in Docker secrets)
# ============================================================================
#
# REQUIRED SECRETS - Create with:
#
# 1. Erlang Cookie (cluster security):
#    openssl rand -base64 48 | tr -d '\n' | docker secret create erlmcp-erlang-cookie -
#
# 2. Database Password:
#    echo "your-db-password" | docker secret create erlmcp-db-password -
#
# 3. Redis Password:
#    echo "your-redis-password" | docker secret create erlmcp-redis-password -
#
# 4. TLS Certificate:
#    cat your-tls.crt | docker secret create erlmcp-tls-cert -
#
# 5. TLS Private Key:
#    cat your-tls.key | docker secret create erlmcp-tls-key -
#
# 6. TLS CA Bundle:
#    cat your-ca-bundle.crt | docker secret create erlmcp-tls-ca -
#
# 7. JWT Private Key (RS256):
#    cat jwt-private.pem | docker secret create erlmcp-jwt-private-key -
#
# 8. JWT Public Key (RS256):
#    cat jwt-public.pem | docker secret create erlmcp-jwt-public-key -
#
# 9. Grafana Admin Password:
#    echo "your-grafana-password" | docker secret create erlmcp-grafana-password -
#
# 10. Backup Encryption Key:
#     echo "your-backup-key" | docker secret create erlmcp-backup-encryption-key -
#
# 11. OpenTelemetry CA Certificate:
#     cat otel-ca.crt | docker secret create erlmcp-otel-ca-cert -
#
# ============================================================================
# VAULT INTEGRATION (Alternative to Docker Secrets)
# ============================================================================
# If using HashiCorp Vault for secrets management:
# VAULT_ADDR=https://vault.prod.internal:8200
# VAULT_ROLE=erlmcp-prod
# VAULT_SECRET_PATH=secret/erlmcp/prod
# ============================================================================
