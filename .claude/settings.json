{
  "$schema": "https://json.schemastore.org/claude-code-settings.json",
  "permissions": {
    "deny": [
      ".env",
      ".env.local",
      ".env.*.local",
      "Secrets/**",
      ".claude/secrets/**",
      "Scripts/deploy.sh",
      "Scripts/release.sh",
      ".git/config",
      "**/*.pem",
      "**/*.key",
      "**/id_rsa*"
    ],
    "allow": [
      "**/*.erl",
      "**/*.hrl",
      "**/*.app.src",
      "Test/**",
      "Apps/*/test/**",
      "Docs/**/*.md",
      "Examples/**",
      "Scripts/quality-*.sh",
      ".claude/**"
    ]
  },
  "hooks": {
    "SessionStart": [
      {
        "matcher": "startup|resume",
        "hooks": [
          {
            "type": "command",
            "command": "./.claude/hooks/SessionStart.sh",
            "timeout": 600,
            "description": "Bootstrap OTP 28.3.1+ and persist environment"
          }
        ]
      }
    ],
    "PreToolUse": [
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "./.claude/hooks/policy-bash.sh",
            "timeout": 10,
            "description": "Network + filesystem governance for Bash commands"
          }
        ]
      },
      {
        "matcher": "WebSearch",
        "hooks": [
          {
            "type": "command",
            "command": "./.claude/hooks/policy-websearch.sh",
            "timeout": 5,
            "description": "Domain filtering for web searches"
          }
        ]
      },
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "command",
            "command": "./.claude/hooks/policy-write.sh",
            "timeout": 5,
            "description": "File pattern validation for writes"
          }
        ]
      }
    ],
    "PostToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "command",
            "command": "./.claude/hooks/post-write-ci.sh",
            "async": true,
            "timeout": 120,
            "description": "Async CI: compile + incremental tests"
          }
        ]
      },
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "./.claude/hooks/post-git-commit.sh",
            "async": true,
            "timeout": 10,
            "description": "Log git commits to audit trail"
          }
        ]
      }
    ],
    "Stop": [],
    "SessionEnd": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "./.claude/hooks/receipt.sh",
            "timeout": 30,
            "description": "Generate session receipt + archive transcript"
          }
        ]
      }
    ],
    "PreCompact": [
      {
        "hooks": [
          {
            "type": "prompt",
            "prompt": "**Critical Invariants (Re-injected Post-Compaction):**\n\n1. OTP >= 28.3.1 (strict requirement)\n2. Chicago TDD (no mocks, real processes only)\n3. Coverage >= 80% (blocking quality gate)\n4. Armstrong principle (illegal states unrepresentable)\n5. Let-it-crash (supervision, not defensive programming)\n\nContinue with these constraints.",
            "description": "Re-inject invariants after context compaction"
          }
        ]
      }
    ]
  },
  "subagents": {
    "verifier": {
      "description": "Verification specialist (read-only + execute tests)",
      "toolAccess": {
        "allow": ["Bash", "Read"],
        "deny": ["Write", "Edit", "Delete", "WebSearch", "WebFetch", "Glob", "Grep", "Task", "Skill", "NotebookEdit"]
      },
      "permissionMode": "execute",
      "skills": ["otp-manager"],
      "preload": [
        ".claude/skills/otp-manager/SKILL.md"
      ]
    },
    "build-engineer": {
      "description": "Code editing specialist (constrained writes)",
      "toolAccess": {
        "allow": ["Bash", "Read", "Write", "Edit"],
        "deny": ["Delete", "WebSearch"]
      },
      "writeConstraints": {
        "allow": [
          "apps/erlmcp_core/src/**/*.erl",
          "apps/erlmcp_core/src/**/*.hrl",
          "apps/erlmcp_transports/src/**/*.erl",
          "apps/erlmcp_observability/src/**/*.erl",
          "apps/erlmcp_validation/src/**/*.erl",
          "apps/*/test/**/*.erl",
          "apps/*/include/**/*.hrl",
          "docs/**/*.md",
          "examples/**"
        ],
        "deny": [
          ".env*",
          "secrets/**",
          "scripts/deploy.sh",
          "scripts/release.sh",
          ".git/**"
        ]
      },
      "permissionMode": "write",
      "skills": ["otp-manager"],
      "preload": [
        ".claude/skills/otp-manager/SKILL.md"
      ]
    },
    "release-scout": {
      "description": "Read-only research specialist (WebSearch enabled)",
      "toolAccess": {
        "allow": ["Read", "WebSearch"],
        "deny": ["Bash", "Write", "Edit", "Delete"]
      },
      "webSearchConstraints": {
        "allowDomains": [
          "github.com",
          "hex.pm",
          "erlang.org",
          "hexdocs.pm",
          "stackoverflow.com"
        ],
        "denyDomains": ["*"],
        "askForOthers": true
      },
      "permissionMode": "read",
      "skills": [],
      "preload": []
    }
  },
  "skills": {
    "otp-manager": {
      "path": ".claude/skills/otp-manager/SKILL.md",
      "description": "Manage Erlang/OTP installation and verification",
      "commands": [
        {
          "name": "fetch-build",
          "description": "Download and build OTP 28.3.1",
          "timeout": 600
        },
        {
          "name": "verify",
          "description": "Check OTP version and compilation",
          "timeout": 30
        },
        {
          "name": "clean",
          "description": "Remove OTP build artifacts",
          "timeout": 60
        }
      ]
    }
  },
  "environment": {
    "variables": {
      "ERLMCP_PROFILE": {
        "value": "cloud",
        "description": "Runtime profile (cloud-optimized settings)"
      },
      "ERLMCP_CACHE": {
        "value": "/home/user/erlmcp/.erlmcp/cache/",
        "description": "Persistent cache directory"
      },
      "TERM": {
        "value": "dumb",
        "description": "Terminal type (rebar3 compatibility)"
      },
      "REBAR_COLOR": {
        "value": "none",
        "description": "Disable ANSI colors in rebar3 output"
      }
    }
  },
  "metadata": {
    "version": "3.1.0",
    "project": "erlmcp",
    "description": "Erlang/OTP MCP SDK governance configuration",
    "architecture": "4-layer governance (Policy to Execution to Verification to Receipt)",
    "armstrong_principles": [
      "Illegal states unrepresentable",
      "Let-it-crash supervision",
      "Chicago TDD (no mocks, real processes)",
      "Coverage >= 80% (blocking gate)",
      "OTP >= 28.3.1 (strict requirement)"
    ],
    "references": {
      "specification": "CLAUDE_CODE_WEB_GOVERNANCE_SYSTEM.md",
      "work_order": "AUTONOMOUS_IMPLEMENTATION_WORK_ORDER.md (WO-003)",
      "project_rules": "CLAUDE.md"
    },
    "last_updated": "2026-02-01",
    "authors": ["code-reviewer (WO-003)"]
  }
}
