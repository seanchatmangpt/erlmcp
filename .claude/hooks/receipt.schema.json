{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://github.com/seanchatmangpt/erlmcp/receipt-schema",
  "title": "erlmcp Session Receipt",
  "description": "Audit trail receipt generated at SessionEnd for erlmcp cloud sessions",
  "type": "object",
  "required": [
    "session_id",
    "timestamp",
    "otp_version",
    "erlmcp_version",
    "build_hash",
    "quality_gates",
    "cost_estimate",
    "time_seconds"
  ],
  "properties": {
    "session_id": {
      "type": "string",
      "description": "Unique session identifier from CLAUDE_SESSION_ID or SESSION_ID env var",
      "pattern": "^[a-zA-Z0-9_-]+$",
      "examples": ["session_015jLVUqHSQc86isYfzL4Byp", "demo-session"]
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO-8601 timestamp of receipt generation",
      "examples": ["2026-02-01T12:34:56Z", "2026-02-01T12:34:56+00:00"]
    },
    "otp_version": {
      "type": "string",
      "description": "Erlang/OTP version detected via erl -noshell",
      "pattern": "^[0-9]+|unknown$",
      "examples": ["28", "28.3.1", "unknown"]
    },
    "erlmcp_version": {
      "type": "string",
      "description": "erlmcp version extracted from apps/erlmcp_core/src/erlmcp_core.app.src",
      "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+|unknown$",
      "examples": ["2.1.0", "3.0.0", "unknown"]
    },
    "build_hash": {
      "type": "string",
      "description": "Git commit SHA-1 hash from git rev-parse HEAD",
      "pattern": "^[0-9a-f]{40}|unknown$",
      "examples": ["abc123def456789012345678901234567890abcd", "unknown"]
    },
    "quality_gates": {
      "type": "object",
      "description": "Quality gate results parsed from build/test logs",
      "required": ["compile", "eunit", "ct", "coverage"],
      "properties": {
        "compile": {
          "type": "string",
          "enum": ["pass", "fail", "unknown"],
          "description": "Compilation status from .erlmcp/build.log"
        },
        "eunit": {
          "type": "string",
          "enum": ["pass", "fail", "unknown"],
          "description": "EUnit test status from .erlmcp/test.log"
        },
        "ct": {
          "type": "string",
          "enum": ["pass", "fail", "unknown"],
          "description": "Common Test status from .erlmcp/test.log"
        },
        "coverage": {
          "type": "string",
          "enum": ["pass", "fail", "unknown"],
          "description": "Coverage â‰¥80% threshold from logs or _build/test/cover/"
        }
      }
    },
    "cost_estimate": {
      "type": "string",
      "description": "Estimated cost based on session duration at $0.10/hour compute",
      "pattern": "^\\$0\\.[0-9]{4}$",
      "examples": ["$0.0083", "$0.0167", "$0.1000"]
    },
    "time_seconds": {
      "type": "integer",
      "description": "Session duration in seconds",
      "minimum": 0,
      "examples": [300, 480, 600]
    }
  },
  "additionalProperties": false
}
