%% Test configuration for erlmcp
%% This configuration is used during automated testing
[
    {erlmcp, [
        %% Server configuration (test-specific)
        {server_name, erlmcp_test_server},
        {port, 0},              % Use random available port for testing
        {max_connections, 10},  % Low limit for testing
        {timeout, 1000},        % Short timeout for fast tests
        {acceptors, 2},         % Minimal acceptors for testing
        
        %% Socket options (minimal for testing)
        {socket_opts, [
            {reuseaddr, true}
        ]},
        
        %% Protocol options (minimal for testing)
        {protocol_opts, [
            {timeout, 1000},
            {max_message_size, 65536}  % 64KB for testing
        ]},
        
        %% Transport configurations (all enabled for comprehensive testing)
        {transports, [
            %% Standard I/O transport (enabled for testing)
            {stdio, #{
                enabled => true,
                buffer_size => 256,     % Small buffer for testing
                timeout => 1000,        % Short timeout for testing
                encoding => utf8
            }},
            
            %% TCP transport (enabled for testing)
            {tcp, #{
                enabled => true,
                port => 0,              % Random port for testing
                acceptors => 2,
                socket_opts => [{reuseaddr, true}],
                backlog => 128
            }},
            
            %% HTTP transport (enabled for testing)
            {http, #{
                enabled => true,
                port => 0,              % Random port for testing
                path => "/mcp",
                ssl_opts => [],
                cors_enabled => true
            }}
        ]},
        
        %% Logging configuration (verbose for test debugging)
        {log_level, debug},
        {log_file, undefined},  % Console only for tests
        
        %% Monitoring and metrics (enabled for test verification)
        {metrics_enabled, true},
        {tracing_enabled, true}
    ]},
    
    %% Kernel configuration (test-specific)
    {kernel, [
        {logger_level, debug},
        {logger, [
            {handler, default, logger_std_h, #{
                level => debug,
                config => #{
                    type => standard_error,
                    sync_mode_qlen => 1,      % Immediate for tests
                    drop_mode_qlen => 10,
                    flush_qlen => 20
                },
                formatter => {logger_formatter, #{
                    single_line => false,
                    template => [time, " [", level, "] ", pid, " ", mfa, ":", line, " - ", msg, "\n"]
                }}
            }}
        ]},
        %% Disable distribution for testing
        {distributed, []},
        %% Short net tick time for testing
        {net_ticktime, 10}
    ]},
    
    %% SASL configuration (minimal for tests)
    {sasl, [
        {sasl_error_logger, false},     % Disable SASL reports in tests
        {errlog_type, error}
    ]},
    
    %% Common Test configuration
    {common_test, [
        {auto_compile, false},
        {create_priv_dir, auto_per_tc},
        {include, ["include"]},
        {logdir, "log/ct"},
        {cover_spec, "test/cover.spec"}
    ]},
    
    %% EUnit configuration
    {eunit, [
        {report, {eunit_surefire, [{dir, "log/eunit"}]}},
        {verbose, true}
    ]},
    
    %% Test-specific runtime tuning
    {vm_args, [
        %% Minimal scheduler setup for tests
        "+S 2:2",
        %% Lower process limit for tests
        "+P 65536",
        %% Lower ETS limit for tests
        "+e 16000",
        %% Enable kernel poll
        "+K true",
        %% Fewer async threads for tests
        "+A 4",
        %% Smaller distribution buffer for tests
        "+zdbbl 8192"
    ]}
].
