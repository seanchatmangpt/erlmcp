%% Staging environment configuration for erlmcp v0.6.0 + TCPS
%% Purpose: Testing in production-like environment with real services
%% Features: Debug logging, basic auth, test service instances

[
    {erlmcp, [
        %% Logging
        {log_level, debug},
        {log_output, [
            {file, "/var/log/erlmcp/staging.log"},
            {console, true}
        ]},

        %% Server Configuration
        {server_defaults, #{
            max_subscriptions_per_resource => 1000,
            max_progress_tokens => 10000,
            request_timeout => 30000
        }},

        %% Client Configuration
        {client_defaults, #{
            timeout => 10000,
            strict_mode => true,
            max_pending_requests => 100,
            retry_attempts => 3,
            retry_delay => 1000
        }},

        %% Transport Configuration
        {transport_defaults, #{
            tcp => #{
                host => "0.0.0.0",
                port => 8080,
                connect_timeout => 10000,
                keepalive => true,
                nodelay => true,
                max_connections => 100
            },
            http => #{
                connect_timeout => 10000,
                request_timeout => 60000,
                max_connections => 200
            },
            stdio => #{
                buffer_size => 8192
            }
        }},

        %% TCPS Configuration
        {tcps, #{
            enabled => true,
            mode => staging,
            quality_gates => #{
                test_pass_rate => 0.80,
                test_coverage => 0.70,
                fail_fast => false
            },
            work_order => #{
                validate_on_compile => true,
                generate_receipt => true,
                check_determinism => true
            },
            andon => #{
                enabled => true,
                webhook_url => "https://staging-alerts.example.com/webhook",
                escalation_timeout => 300
            },
            observability => #{
                otel_enabled => true,
                otel_endpoint => "http://otel-collector-staging:4317",
                trace_sampling_rate => 0.5,
                metrics_interval => 30
            },
            persistence => #{
                enabled => true,
                backend => postgres,
                connection => #{
                    host => "postgres-staging.example.com",
                    port => 5432,
                    database => "erlmcp_staging",
                    username => "erlmcp_staging",
                    password => {env, "ERLMCP_DB_PASSWORD"},
                    pool_size => 10
                }
            }
        }},

        %% Authentication
        {auth, #{
            enabled => true,
            type => basic,
            users => [
                {<<"staging-user">>, <<"staging-pass">>}
            ]
        }},

        %% Connection Pooling
        {poolboy, [
            {size, 10},
            {max_overflow, 20}
        ]},

        %% Dashboard
        {dashboard, #{
            enabled => true,
            port => 3000,
            host => "0.0.0.0"
        }}
    ]},

    %% SASL (System Architecture Support Libraries)
    {sasl, [
        {sasl_error_logger, {file, "/var/log/erlmcp/staging-sasl.log"}},
        {errlog_type, all}
    ]},

    %% Kernel
    {kernel, [
        {logger_level, debug},
        {logger, [
            {handler, default, logger_std_h, #{
                config => #{
                    file => "/var/log/erlmcp/staging-kernel.log"
                },
                formatter => {logger_formatter, #{
                    single_line => false,
                    time_designator => $
                }}
            }}
        ]}
    ]}
].
