% ERLMCP v3 Enterprise Scaling Configuration
% This configuration contains all scaling parameters for Fortune 500 deployments

{scaling, [
    {horizontal_scaling, [
        {cluster_name, "erlmcp-enterprise"},
        {max_nodes, 100},
        {min_nodes, 3},
        {initial_nodes, 10},
        {scaling_strategy, "reactive"},
        {proactive_scaling, true},
        {scaling_cooldown, 300}, %% 5 minutes

        %% Scaling thresholds
        {scaling_thresholds, [
            {cpu_threshold, 80},        %% Percentage
            {memory_threshold, 85},     %% Percentage
            {connection_threshold, 50000},
            {request_rate_threshold, 100000},
            {queue_threshold, 10000},
            {error_rate_threshold, 1}   %% Percentage
        ]},

        %% Batch scaling parameters
        {batch_scaling, true},
        {batch_size, 5},
        {batch_interval, 60},        %% seconds

        %% Scaling policies
        {scaling_policies, [
            {name, "cpu_based"},
            {threshold, 80},
            {scale_up_factor, 1.5},
            {scale_down_factor, 0.8},
            {cool_down, 300}
        },
        {name, "memory_based"},
        {threshold, 85},
        {scale_up_factor, 1.2},
        {scale_down_factor, 0.7},
        {cool_down, 300}
        ]}
    ]},

    {session_management, [
        {shard_count, 16},
        {replication_factor, 3},
        {persistence_backend, "mnesia"},
        {shard_strategy, "consistent_hash"},
        {session_timeout, 3600},          %% seconds (1 hour)
        {max_sessions_per_node, 5000},
        {session_migration_enabled, true},
        {migration_strategy, "warm"},
        {migration_timeout, 300},          %% 5 minutes

        %% Session lifecycle
        {session_cleanup_interval, 300},   %% 5 minutes
        {max_session_age, 86400},          %% 24 hours
        {idle_session_timeout, 1800},       %% 30 minutes

        %% Session state
        {session_state_size, "small"},      %% small, medium, large
        {state_compression, true},
        {state_encryption, true}
    ]},

    {caching, [
        {cache_strategy, "hierarchical"},
        {enable_caching, true},
        {cache_ttl, 3600},               %% 1 hour

        %% Local cache (ETS)
        {local_cache, [
            {size, 1000},
            {ttl, 300},                    %% 5 minutes
            {eviction_policy, "lru"},
            {memory_threshold, 85}
        ]},

        %% Distributed cache (Redis)
        {distributed_cache, [
            {nodes, ["redis-node-1", "redis-node-2", "redis-node-3"]},
            {max_memory, "4gb"},
            {replication, true},
            {cluster_mode, true},
            {password_protected, true},
            {tls_enabled, true}
        ]},

        %% Cache invalidation
        {cache_invalidation, [
            {mode, "event_driven"},
            {invalidation_queue, "cache_invalidation"},
            {batch_size, 100},
            {timeout, 5000}
        ]},

        %% Cache warming
        {cache_warming, [
            {enabled, true},
            {warmup_interval, 300},        %% 5 minutes
            {priority_resources, ["/config", "/schema", "/templates"]}
        ]}
    ]},

    {load_balancing, [
        {algorithm, "least_connections"},
        {health_check_interval, 5000},
        {connection_timeout, 10000},
        {read_timeout, 30000},
        {idle_timeout, 60000},

        %% Balancing weights
        {node_weights, [
            {cpu_weight, 0.4},
            {memory_weight, 0.3},
            {connection_weight, 0.3}
        ]},

        %% Sticky sessions
        {sticky_sessions, false},
        {session_timeout, 3600},

        %% Load shedding
        {load_shedding, true},
        {shedding_threshold, 90},          %% Percentage
        {shedding_strategy, "random"}
    ]},

    {database, [
        {primary_backend, "postgresql"},
        {replica_backends, ["postgresql", "read_replica_1", "read_replica_2"]},

        %% Sharding
        {sharding_enabled, true},
        {shard_strategy, "range"},
        {shard_count, 8},
        {replication_factor, 3},

        %% Connection pooling
        {connection_pool, [
            {max_connections, 100},
            {max_idle_time, 30000},
            {keep_alive, true},
            {tcp_cork, true}
        ]},

        %% Query optimization
        {query_cache, true},
        {prepared_statements, true},
        {bulk_operations, true},

        %% Backup
        {backup_enabled, true},
        {backup_interval, 3600},          %% 1 hour
        {retention_days, 30}
    ]},

    {queue_management, [
        {queue_strategy, "priority"},
        {max_queue_size, 100000},
        {queue_timeout, 30000},

        %% Priority levels
        {priorities, [
            {name, "high", weight: 10, timeout: 5000},
            {name, "medium", weight: 5, timeout: 15000},
            {name, "low", weight: 1, timeout: 30000}
        ]},

        %% Queue scaling
        {queue_scaling, [
            {enabled, true},
            {scale_threshold, 80},         %% Percentage
            {max_shards, 16},
            {shard_distribution, "even"}
        ]},

        %% Dead letter queue
        {dlq_enabled, true},
        {dlq_retry_count, 3},
        {dlq_expiration, 86400}           %% 24 hours
    ]},

    {network, [
        {connection_pool, [
            {max_connections, 10000},
            {max_idle_time, 30000},
            {keep_alive, true},
            {tcp_cork, true},
            {buffer_size, 65536}
        ]},

        {protocols, [
            {http_version, 2},
            {websocket_compression, true},
            {request_timeout, 30000},
            {response_timeout, 60000}
        ]},

        {throttling, [
            {enabled, true},
            {max_connections, 50000},
            {max_requests_per_second, 100000},
            {burst_size, 20000}
        ]},

        {compression, [
            {enabled, true},
            {algorithm, "brotli"},
            {min_size, 1024},              %% bytes
            {quality, 6}
        ]}
    ]},

    {observability, [
        {metrics_collection, true},
        {metrics_interval, 15000},         %% 15 seconds

        %% Metrics retention
        {metrics_retention, [
            {time_series, 7},              %% days
            {logs, 30},                    %% days
            {traces, 3}                    %% days
        ]},

        %% Alerting
        {alerting_enabled, true},
        {alert_cooldown, 300},            %% 5 minutes
        {alert_channels, [
            {type, "email"},
            {type, "slack"},
            {type, "pagerduty"}
        ]},

        %% Profiling
        {profiling, [
            {enabled, true},
            {sample_rate, 100},
            {retention_hours, 24}
        ]}
    ]},

    {cost_optimization, [
        {spot_instances, true},
        {instance_mix, [
            {reserved_percentage, 30},
            {spot_percentage, 40},
            {on_demand_percentage, 30}
        ]},

        {rightsizing, true},
        {rightsizing_interval, 86400},    %% 24 hours
        {min_utilization, 70},            %% Percentage

        {data_transfer, [
            {cdn_enabled, true},
            {compression_enabled, true},
            {caching_enabled, true}
        ]}
    ]},

    {security, [
        {authentication, [
            {provider, "oauth2"},
            {fallback_provider, "jwt"},
            {session_timeout, 3600}
        ]},

        {authorization, [
            {rbac_enabled, true},
            {policy_engine, "opa"},
            {attribute_based, true}
        ]},

        {encryption, [
            {transport, "tls_1.3"},
            {data_at_rest, "aes_256_gcm"},
            {key_rotation, 86400}           %% 24 hours
        ]},

        {compliance, [
            {standards, ["soc2", "hipaa", "gdpr"]},
            {audit_logging, true},
            {penetration_testing, true}
        ]}
    ]},

    {disaster_recovery, [
        {backup_strategy, "offsite"},
        {backup_frequency, "hourly"},
        {recovery_point_objective, 15},  %% minutes
        {recovery_time_objective, 60},    %% minutes

        {failover, [
            {enabled, true},
            {auto_failover, true},
            {failover_timeout, 300},       %% 5 minutes
            {failback_strategy, "gradual"}
        ]},

        {regional_failover, [
            {active_regions, 3},
            {load_balancing, "round_robin"},
            {data_consistency, "eventual"}
        ]}
    ]},

    {performance, [
        {throughput_targets, [
            {requests_per_second, 100000},
            {concurrent_connections, 1000000},
            {response_time_p99, 100}        %% milliseconds
        ]},

        {optimization, [
            {hot_code_reload, true},
            {jit_compilation, true},
            {connection_pooling, true},
            {caching, true}
        ]},

        {benchmarking, [
            {enabled, true},
            {frequency, "daily"},
            {duration, 3600},               %% 1 hour
            {load_profile, "peak"}
        ]}
    ]}
]}.