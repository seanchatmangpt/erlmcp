# Database Connection Pool Configuration
[postgresql]
; Connection pooling for primary database
pool_name = "erlmcp-primary"
pool_size = 50
max_pool_size = 100
min_pool_size = 20
idle_timeout = 300
max_lifetime = 86400
connection_timeout = 3000
checkout_timeout = 5000

; Connection pooling for read replicas
replica_pool_name = "erlmcp-replica"
replica_pool_size = 200
replica_max_pool_size = 400
replica_min_pool_size = 100

; Load balancing configuration
load_balance_type = "round_robin"
read_preference = "primary_preferred"
health_check_timeout = 1000
health_check_interval = 30000

; Performance tuning
prepare_threshold = 5
default_auto_commit = false
get_delegate = false
auto_reconnect = true
register_mbeans = true

; SSL configuration
ssl = true
sslmode = "verify-full"
sslrootcert = "/etc/ssl/certs/erlmcp-ca.crt"
sslkey = "/etc/ssl/private/erlmcp-client.key"
sslcert = "/etc/ssl/certs/erlmcp-client.crt"

[mysql]
; MySQL connection pool (alternative for specific workloads)
mysql_pool_name = "erlmcp-mysql"
mysql_pool_size = 30
mysql_max_pool_size = 60
mysql_idle_timeout = 600
mysql_max_lifetime = 43200
mysql_connection_timeout = 5000

; Connection routing
router_mode = "transactional"
router_mode_write = "primary"
router_mode_read = "replica"
router_failover_mode = "readonly"

; Performance settings
pool_ping = true
pool_ping_timeout = 2000
pool_ping_query = "SELECT 1"
pool_prepared_statements = true
pool_cache_prepared_statements = true
use_server_prepared_statements = true
rewrite_batched_statements = true
cache_prepared_statements = true

[redis]
; Redis connection pool for caching
redis_pool_name = "erlmcp-redis"
redis_pool_size = 50
redis_max_pool_size = 100
redis_idle_timeout = 300
redis_connection_timeout = 5000
redis_max_idle = 20
redis_min_idle = 5

; Redis cluster configuration
redis_cluster_mode = true
redis_cluster_timeout = 5000
redis_cluster_max_redirects = 3
redis_cluster_slave_validity_period = 60000

; Performance optimizations
redis_client_name = "erlmcp-app"
redis_tcp_no_delay = true
redis_tcp_keepalive = true
redis_tcp_keepalive_idle = 300
redis_tcp_keepalive_interval = 60
redis_tcp_keepalive_count = 3

[cassandra]
; Cassandra connection pool
cassandra_pool_name = "erlmcp-cassandra"
cassandra_pool_size = 25
cassandra_max_pool_size = 50
cassandra_idle_timeout = 600
cassandra_connect_timeout = 5000
cassandra_read_timeout = 12000
cassandra_write_timeout = 12000

; Consistency levels
cassandra_consistency_level = "QUORUM"
cassandra_serial_consistency_level = "LOCAL_QUORUM"
cassandra_default_consistency = "QUORUM"
cassandra_default_serial_consistency = "LOCAL_QUORUM"

; Performance tuning
cassandra_query_timeout = 10000
cassandra_schema_agreement_timeout = 10000
cassandra_retry_policy = "fallthrough"
cassandra_idempotence = true
cassandra_speculative_execution_policy = "constant(100)"

[monitoring]
; Pool monitoring
enable_monitoring = true
monitor_interval = 10000
collect_metrics = true
collect_stats = true
log_slow_queries = true
slow_query_threshold_ms = 1000

; Alert thresholds
alert_high_usage_percent = 80
alert_low_usage_percent = 10
alert_failed_connections_percent = 5
alert_long_wait_time_ms = 1000

; Performance profiling
enable_profiling = false
profile_slow_queries = true
profile_sample_rate = 0.1
profile_max_samples_per_hour = 100