%% TCPS Dashboard Configuration
%% Example configuration file for the TCPS metrics dashboard

[
    {tcps_dashboard, [
        %% HTTP server configuration
        {port, 8080},

        %% Auto-refresh interval in milliseconds (default: 5000 = 5 seconds)
        {refresh_interval, 5000},

        %% Number of days of historical data to maintain (default: 30)
        {history_days, 30},

        %% Enable basic authentication (default: false)
        {enable_auth, false},

        %% Basic auth credentials (only used if enable_auth is true)
        {auth_username, <<"admin">>},
        {auth_password, <<"changeme">>},

        %% CORS settings
        {cors_enabled, true},
        {cors_allowed_origins, [<<"*">>]},

        %% Metrics thresholds
        {wip_limits, #{
            backlog => infinity,
            ready => 5,
            in_progress => 3,
            review => 5,
            done => infinity
        }},

        %% Quality gate targets
        {quality_targets, #{
            test_pass_rate => 0.80,
            code_coverage => 0.80,
            defect_rate => 0.01,
            first_pass_yield => 0.95
        }},

        %% Andon alert configuration
        {andon_config, #{
            auto_trigger_on_test_failure => true,
            auto_trigger_on_wip_limit => true,
            severity_escalation_minutes => 30,
            notification_enabled => true
        }},

        %% Kaizen metrics configuration
        {kaizen_config, #{
            track_improvement_weekly => true,
            improvement_target_percentage => 0.05,
            waste_categories => [waiting, rework, overprocessing, motion, inventory]
        }},

        %% Production flow configuration
        {flow_config, #{
            throughput_window_days => 7,
            cycle_time_buckets => [
                {<<"0-24h">>, 0, 24},
                {<<"24-48h">>, 24, 48},
                {<<"48-72h">>, 48, 72},
                {<<"72h+">>, 72, infinity}
            ]
        }},

        %% Export configuration
        {export_config, #{
            json_enabled => true,
            csv_enabled => true,
            pdf_enabled => false,  % PDF export requires additional dependencies
            report_template => "default"
        }},

        %% SSE (Server-Sent Events) configuration
        {sse_config, #{
            heartbeat_interval_ms => 30000,
            max_connections => 100,
            connection_timeout_ms => 300000
        }},

        %% Logging configuration
        {logging, #{
            level => info,
            log_http_requests => true,
            log_metrics_updates => false
        }}
    ]},

    %% Cowboy HTTP server options
    {cowboy, [
        {num_acceptors, 100},
        {max_connections, 1000}
    ]},

    %% Kernel logger configuration for dashboard
    {kernel, [
        {logger_level, info},
        {logger, [
            {handler, default, logger_std_h, #{
                formatter => {logger_formatter, #{
                    single_line => true,
                    time_designator => $\s
                }}
            }}
        ]}
    ]}
].
