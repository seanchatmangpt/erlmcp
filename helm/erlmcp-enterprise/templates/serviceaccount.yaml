{{/*
  ERLMCP Enterprise ServiceAccount
  Service account for pod identity
*/}}
{{- if .Values.security.rbac.create }}
apiVersion: v1
kind: ServiceAccount
metadata:
  name: {{ include "erlmcp-enterprise.serviceAccountName" . }}
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "erlmcp-enterprise.labels" . | nindent 4 }}
    component: serviceaccount
  annotations:
    {{- with .Values.security.rbac.serviceAccountAnnotations }}
    {{- toYaml . | nindent 4 }}
    {{- end }}
    {{- if .Values.security.rbac.gcpServiceAccount }}
    "iam.gke.io/gcp-service-account": {{ .Values.security.rbac.gcpServiceAccount | quote }}
    {{- end }}
    {{- if .Values.security.rbac.awsRole }}
    "eks.amazonaws.com/role-arn": {{ .Values.security.rbac.awsRole | quote }}
    {{- end }}
    {{- if .Values.security.rbac.azureIdentity }}
    "azure.workload.identity/client-id": {{ .Values.security.rbac.azureIdentity.clientId | quote }}
    {{- end }}
automountServiceAccountToken: {{ .Values.security.rbac.automountServiceAccountToken | default true }}
{{- with .Values.image.imagePullSecrets }}
imagePullSecrets:
  {{- toYaml . | nindent 2 }}
{{- end }}
{{- end }}
