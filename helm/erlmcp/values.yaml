# ==============================================================================
# erlmcp Helm Chart - Default Values
# ==============================================================================
# Erlang/OTP MCP SDK - Enterprise-grade Model Context Protocol implementation
# Used as base configuration; profile-specific values override (dev, staging, gov)
# ==============================================================================

replicaCount: 3

image:
  registry: us-central1-docker.pkg.dev
  repository: taiea-v1/erlmcp-repo/erlmcp
  tag: ""  # Defaults to Chart.appVersion
  pullPolicy: IfNotPresent

imagePullSecrets:
  - name: gcr-secret

nameOverride: ""
fullnameOverride: ""

serviceAccount:
  create: true
  annotations: {}
  name: ""  # Defaults to release name

podAnnotations:
  prometheus.io/scrape: "true"
  prometheus.io/port: "9090"
  prometheus.io/path: "/metrics"

podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000

securityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: false
  capabilities:
    drop:
      - ALL

service:
  type: LoadBalancer
  port: 8080
  annotations: {}
  loadBalancerIP: ""
  loadBalancerSourceRanges: []

# Erlang/OTP runtime configuration
erlang:
  # Profile: dev, test, staging, prod
  profile: prod
  # Erlang distribution cookie (leave empty to auto-generate)
  cookie: ""
  # Async thread pool size
  asyncThreads: 10
  # Max ports (file descriptors)
  maxPorts: 65536
  # Max Erlang processes
  maxProcesses: 1048576
  # Scheduler bind type: db (default bound), u (unbound), s (spread)
  schedulerBindType: db
  # Erlang distribution (clustering) settings
  distribution:
    enabled: false
    port: 9000

# Application configuration
config:
  logLevel: info
  maxSubscriptions: 1000
  requestTimeout: 30000
  maxMessageSize: 1048576

# Metrics/monitoring
metrics:
  enabled: true
  port: 9090
  path: /metrics

resources:
  limits:
    cpu: 2000m
    memory: 2Gi
  requests:
    cpu: 1000m
    memory: 1Gi

autoscaling:
  enabled: true
  minReplicas: 3
  maxReplicas: 10
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80

nodeSelector: {}

affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: app
                operator: In
                values:
                  - erlmcp
          topologyKey: kubernetes.io/hostname

tolerations: []

# Extra environment variables
extraEnv: []
#  - name: MY_VAR
#    value: "my-value"
#  - name: SECRET_VAR
#    valueFrom:
#      secretKeyRef:
#        name: my-secret
#        key: my-key

extraEnvFrom: []
#  - secretRef:
#      name: my-secret
#  - configMapRef:
#      name: my-configmap

# Secrets (override at deployment - these are sensitive!)
secrets:
  # Database URL (base64 encoded in generated secret)
  databaseUrl: ""
  # API key
  apiKey: ""
  # Additional secrets as key-value pairs
  extra: {}

# Extra volumes and mounts
extraVolumes: []
extraVolumeMounts: []

# Storage configuration
persistence:
  enabled: false
  storageClassName: "standard"
  accessMode: ReadWriteOnce
  size: 1Gi
  mountPath: /var/lib/erlmcp

# Health probes (BEAM-aware)
probes:
  liveness:
    path: /health
    initialDelaySeconds: 15
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
  readiness:
    path: /ready
    initialDelaySeconds: 5
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3
  startup:
    path: /health
    initialDelaySeconds: 5
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 30

# Graceful shutdown (allow in-flight requests to complete)
terminationGracePeriodSeconds: 30

# GCP-specific settings
gcp:
  project: "taiea-v1"
  region: "us-central1"
  artifactRegistry:
    enabled: true
    repository: "erlmcp-repo"
  logging:
    enabled: true
    level: "info"
  monitoring:
    enabled: true

# Ingress configuration
ingress:
  enabled: false
  annotations: {}
  hosts:
    - host: erlmcp.example.com
      paths:
        - path: /
          pathType: Prefix
  tls: []

# Network policies
networkPolicy:
  enabled: false
  policyTypes:
    - Ingress
    - Egress

# Pod disruption budget
podDisruptionBudget:
  enabled: false
  minAvailable: 2

# Rollout strategy
strategy:
  type: RollingUpdate
  rollingUpdate:
    maxSurge: 1
    maxUnavailable: 0
