# ggen Configuration for erlmcp - Erlang MCP SDK
# Ontology-driven code generation for Toyota Code Production System (TCPS)

[project]
name = "erlmcp"
version = "0.6.0"
description = "Erlang/OTP MCP SDK with TCPS quality system"
authors = ["erlmcp Team"]
license = "Apache-2.0"

# RDF Ontology Configuration
[ontology]
# Source directories for RDF/Turtle ontologies
source = "ontology/"
# Additional ontology paths
paths = [
    "ontology/tcps_core.ttl",
    "ontology/tcps_quality.ttl",
    "ontology/tcps_flow.ttl",
    "ontology/tcps_root_cause.ttl",
    "ontology/work_orders.ttl",
    "ontology/example_instance_data.ttl"
]
# SHACL shapes for validation
shapes = "shapes/tcps_shapes.ttl"
# Ontology format (turtle, rdf/xml, n-triples, json-ld)
format = "turtle"

# SPARQL Queries Configuration
[queries]
# Directory containing SPARQL queries
source_dir = "sparql/tcps_queries"
# Use optimized queries when available
optimized_dir = "sparql/tcps_queries_optimized"
# Query naming convention: query_name.rq

# Named queries for different generation tasks
[queries.named]
sku_readiness = "sku_readiness.rq"
quality_metrics = "quality_metrics.rq"
work_orders_pending = "work_orders_pending.rq"
andon_active = "andon_active.rq"
receipts_by_stage = "receipts_by_stage.rq"
heijunka_schedule = "heijunka_schedule.rq"

# Template Configuration
[templates]
# Template directory
source_dir = "templates/ggen"
# Template engine: tera (Jinja2-like)
engine = "tera"
# Output directory for generated files
output_dir = "generated"

# Generation Rules
# Each rule maps SPARQL queries to templates for code generation

[[generation.rules]]
name = "sku_listings"
description = "Generate marketplace SKU listings from ontology"
query = "sku_readiness"
template = "sku_listing.md.tera"
output = "marketplace/sku-{{ sku_id }}.md"
enabled = true

[[generation.rules]]
name = "quality_reports"
description = "Generate quality assurance reports"
query = "quality_metrics"
template = "quality_report.md.tera"
output = "reports/quality-{{ report_id }}.md"
enabled = true

[[generation.rules]]
name = "work_orders"
description = "Generate work order RDF instances"
query = "work_orders_pending"
template = "work_order.ttl.tera"
output = "work_orders/{{ work_order_id }}.ttl"
enabled = true

[[generation.rules]]
name = "andon_events"
description = "Generate Andon event records"
query = "andon_active"
template = "andon_event.ttl.tera"
output = "andon/{{ andon_id }}.ttl"
enabled = true

[[generation.rules]]
name = "receipts"
description = "Generate production receipts (proof of work)"
query = "receipts_by_stage"
template = "receipt.json.tera"
output = "receipts/{{ stage_name }}-{{ timestamp }}.json"
enabled = true

[[generation.rules]]
name = "standard_work"
description = "Generate standard work documentation"
query = "quality_metrics"
template = "standard_work.md.tera"
output = "docs/standard-work/{{ stage_name }}.md"
enabled = true

# Code Generation for Erlang Modules
[[generation.rules]]
name = "erlang_types"
description = "Generate Erlang type definitions from ontology classes"
query = "sku_readiness"
template = "erlang_types.hrl.tera"
output = "include/generated_types.hrl"
enabled = true

[[generation.rules]]
name = "erlang_records"
description = "Generate Erlang records from TCPS ontology"
query = "quality_metrics"
template = "erlang_records.hrl.tera"
output = "include/tcps_records.hrl"
enabled = true

# Validation Configuration
[validation]
# Run SHACL validation before generation
shacl_validate = true
# Fail on validation errors
fail_on_error = true
# Generate validation report
report_path = "validation_report.md"

# Quality Gates (Poka-Yoke Error Proofing)
[quality]
# Enforce SLO timeouts
enforce_slo = true
# Default timeout for generation (ms)
generation_timeout_ms = 5000
# Andon signal thresholds
[quality.andon]
# Red (STOP): Critical errors
red_threshold = 1
# Yellow (CAUTION): Warnings
yellow_threshold = 3
# Green (GO): All clear
green_threshold = 0

# Output Configuration
[output]
# Clean output directory before generation
clean = false
# Create output directory if it doesn't exist
create_dirs = true
# Preserve existing files not generated by ggen
preserve_existing = true
# Generate index of all created files
generate_index = true
index_path = "generated/INDEX.md"

# Determinism Settings (TCPS Compliance)
[determinism]
# Sort keys in generated JSON/maps
sort_keys = true
# Use UTC timestamps in ISO 8601 format
utc_timestamps = true
# Include checksums in generated files
include_checksums = true
# Checksum algorithm (sha256, sha512)
checksum_algorithm = "sha256"

# Logging Configuration
[logging]
# Log level: debug, info, warn, error
level = "info"
# Log format: text, json
format = "text"
# Log output path (stdout, stderr, or file path)
output = "stdout"

# Feature Flags
[features]
# Enable AI-powered generation (requires ggen-ai)
ai_generation = false
# Enable PaaS infrastructure generation
paas_generation = false
# Enable experimental features
experimental = false

# Development Settings
[dev]
# Watch mode: auto-regenerate on file changes
watch = false
# Watch paths
watch_paths = ["ontology/**/*.ttl", "templates/**/*.tera", "sparql/**/*.rq"]
# Debounce delay (ms)
watch_debounce_ms = 500
