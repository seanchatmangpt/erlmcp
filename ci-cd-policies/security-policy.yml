# ErlMCP v3 Security Policy
# Comprehensive security scanning and compliance for CI/CD pipeline

version: 1.0
description: "Security policy for ErlMCP v3 enterprise CI/CD pipeline"

# Security Scanning Configuration
security_scans:
  # Static Application Security Testing (SAST)
  sast:
    enabled: true
    tools:
      - semgrep
      - bandit
      - eslint
      - codespell
      - commitlint
    rulesets:
      - owasp-top-ten
      - nvd-cve
      - erlang-security
    policy:
      critical_vulnerabilities: 0
      high_vulnerabilities: 0
      medium_vulnerabilities: 0  # Zero tolerance for medium in production
      low_vulnerabilities: 10  # Allow 10 low-severity issues

  # Software Composition Analysis (SCA)
  sca:
    enabled: true
    tools:
      - trivy
      - dependency-check
      - snyk
    policy:
      outdated_deps: 0
      vulnerabilities:
        critical: 0
        high: 0
        medium: 5
        low: 20
      licenses:
        restricted: 0
        proprietary: 0
        copyleft: 0

  # Container Security
  container:
    enabled: true
    tools:
      - trivy
      - grype
      - syft
    policy:
      critical_vulnerabilities: 0
      high_vulnerabilities: 0
      image_secrets: 0  # No secrets in images
      malicious_packages: 0

  # Infrastructure as Code (IaC) Security
  iac:
    enabled: true
    tools:
      - tfsec
      - checkov
    policy:
      critical_issues: 0
      high_issues: 0
      aws_compliance: CIS
      gcp_compliance: CIS

  # Secrets Management
  secrets:
    enabled: true
    tools:
      - detect-secrets
      - trufflehog
    policy:
      secrets_found: 0
      hardcoded_credentials: 0
      api_keys_in_code: 0

# Security Compliance Requirements
compliance:
  standards:
    - ISO 27001
    - SOC 2
    - PCI DSS
    - HIPAA
    - GDPR
    - NIST CSF

  controls:
    access_control:
      - principle_of_least_privilege
      - multi_factor_authentication
      - just_in_time_access

    data_protection:
      - encryption_at_rest
      - encryption_in_transit
      - data_masking

    network_security:
      - network_segmentation
      - firewall_rules
      - intrusion_detection

    incident_response:
      - incident_playbooks
      - backup_verification
      - disaster_recovery

# Security Gates
security_gates:
  mandatory:
    - sast_results
    - sca_results
    - container_scan
    - secrets_scan

  advisory:
    - iac_scan
    - dependency_updates
    - license_compliance

# Environment Security Policies
environment_policies:
  development:
    scanning_frequency: 'on_push'
    s_medium_vulnerabilities: 5
    s_low_vulnerabilities: 20

  staging:
    scanning_frequency: 'on_merge'
    s_medium_vulnerabilities: 0
    s_low_vulnerabilities: 10
    required_signatures: 1

  production:
    scanning_frequency: 'before_deploy'
    s_medium_vulnerabilities: 0
    s_low_vulnerabilities: 0
    required_signatures: 2
    manual_approval_required: true

# Security Workflow Integration
workflow:
  pre_commit:
    checks:
      - linting
      - secret_scanning
      - dependency_vetting
    required_for: 'all'

  pre_merge:
    checks:
      - sast_scan
      - dependency_scan
      - security_audit
    required_for: ['staging', 'production']

  pre_deploy:
    checks:
      - container_scan
      - compliance_check
      - infrastructure_scan
    required_for: ['production']

# Security Monitoring
monitoring:
  real_time_alerting:
    critical_vulnerabilities: 'immediate'
    high_vulnerabilities: 'within_1_hour'
    unauthorized_access: 'immediate'

  metrics_tracking:
    - vulnerability_density
    - mean_time_to_detection
    - mean_time_to_repair

  compliance_reporting:
    frequency: 'daily'
    formats: ['pdf', 'json']
    retention: '365_days'

# Security Training Requirements
training:
  required_annually:
    - security_basics
    - secure_coding_practices
    - incident_response_procedures

  quarterly_updates:
    - new_threat_vectors
    - tool_updates
    - policy_changes

# Security Incident Response
incident_response:
  severity_levels:
    critical:
      response_time: '15_minutes'
      escalation: 'ciso'
      containment: 'immediate'

    high:
      response_time: '1_hour'
      escalation: 'security_lead'
      containment: 'within_4_hours'

    medium:
      response_time: '4_hours'
      escalation: 'security_team'
      containment: 'within_24_hours'

    low:
      response_time: '24_hours'
      escalation: 'security_analyst'
      containment: 'within_72_hours'

# Document References
documents:
  policies:
    - security_policy.md
    - incident_response_plan.md
    - compliance_requirements.md

  procedures:
    - vulnerability_management.md
    - change_management.md
    - access_control_procedures.md