---
# ============================================================================
# ErlMCP v3.0.0 - Production Secret Template
# ============================================================================
# IMPORTANT: This is a TEMPLATE file. DO NOT commit actual secrets.
# Create secrets using one of the following methods:
#
# 1. Kubernetes secret:
#    kubectl create secret generic erlmcp-secrets \
#      --from-literal=erlang-cookie=$(openssl rand -base64 48) \
#      --from-literal=db-password=YOUR_DB_PASSWORD \
#      --from-literal=jwt-secret=$(openssl rand -base64 32) \
#      --namespace=erlmcp-production
#
# 2. SealedSecret (recommended for GitOps):
#    kubeseal -f k8s/production/secret.yaml -w k8s/production/sealed-secret.yaml
#
# 3. External Secrets Operator (for Vault/AWS Secrets Manager):
#    See: k8s/deployments/helm/erlmcp/templates/external-secrets/
#
# ============================================================================
# Usage:
#   kubectl apply -f k8s/production/secret.yaml
# ============================================================================

---
# ============================================================================
# APPLICATION SECRETS
# ============================================================================
apiVersion: v1
kind: Secret
metadata:
  name: erlmcp-secrets
  namespace: erlmcp-production
  labels:
    app: erlmcp
    environment: production
    component: secrets
  annotations:
    description: "ErlMCP production secrets - UPDATE WITH ACTUAL VALUES"
type: Opaque
stringData:
  # --------------------------------------------------------------------------
  # ERLANG COOKIE - Cluster authentication (REQUIRED)
  # --------------------------------------------------------------------------
  # Generate with: openssl rand -base64 48 | tr -d '\n'
  # All nodes in the cluster must share the same cookie
  erlang-cookie: "CHANGE_ME_GENERATE_WITH_OPENSSL"

  # --------------------------------------------------------------------------
  # DATABASE SECRETS
  # --------------------------------------------------------------------------
  db-host: "postgres.production.svc.cluster.local"
  db-port: "5432"
  db-name: "erlmcp_prod"
  db-user: "erlmcp"
  db-password: "CHANGE_ME_STRONG_PASSWORD"
  # Alternative: connection string
  # db-connection-string: "postgresql://erlmcp:PASSWORD@postgres:5432/erlmcp_prod"

  # --------------------------------------------------------------------------
  # REDIS SECRETS
  # --------------------------------------------------------------------------
  redis-host: "redis.production.svc.cluster.local"
  redis-port: "6379"
  redis-password: "CHANGE_ME_REDIS_PASSWORD"

  # --------------------------------------------------------------------------
  # JWT SECRETS
  # --------------------------------------------------------------------------
  # HS256 secret key (generate with: openssl rand -base64 32)
  jwt-secret: "CHANGE_ME_GENERATE_WITH_OPENSSL"
  # RS256 keys (for production - recommended)
  # jwt-private-key: |
  #   -----BEGIN RSA PRIVATE KEY-----
  #   YOUR_PRIVATE_KEY_HERE
  #   -----END RSA PRIVATE KEY-----
  # jwt-public-key: |
  #   -----BEGIN PUBLIC KEY-----
  #   YOUR_PUBLIC_KEY_HERE
  #   -----END PUBLIC KEY-----

  # --------------------------------------------------------------------------
  # TLS CERTIFICATES (if using Secret instead of cert-manager)
  # --------------------------------------------------------------------------
  # tls.crt: |
  #   -----BEGIN CERTIFICATE-----
  #   YOUR_CERTIFICATE_HERE
  #   -----END CERTIFICATE-----
  # tls.key: |
  #   -----BEGIN PRIVATE KEY-----
  #   YOUR_PRIVATE_KEY_HERE
  #   -----END PRIVATE KEY-----
  # ca.crt: |
  #   -----BEGIN CERTIFICATE-----
  #   YOUR_CA_CERTIFICATE_HERE
  #   -----END CERTIFICATE-----

  # --------------------------------------------------------------------------
  # OAUTH2/OIDC SECRETS (if using OAuth2)
  # --------------------------------------------------------------------------
  oauth2-client-id: "CHANGE_ME_CLIENT_ID"
  oauth2-client-secret: "CHANGE_ME_CLIENT_SECRET"
  oauth2-redirect-uri: "https://erlmcp.example.com/oauth/callback"

  # --------------------------------------------------------------------------
  # SAML SECRETS (if using SAML)
  # --------------------------------------------------------------------------
  saml-idp-metadata-url: "https://idp.example.com/metadata"
  saml-sp-private-key: "CHANGE_ME_SAML_KEY"
  saml-sp-certificate: "CHANGE_ME_SAML_CERT"

  # --------------------------------------------------------------------------
  # EXTERNAL API KEYS
  # --------------------------------------------------------------------------
  # api-key-external: "CHANGE_ME_EXTERNAL_API_KEY"
  # honeycomb-api-key: "CHANGE_ME_HONEYCOMB_KEY"
  # datadog-api-key: "CHANGE_ME_DATADOG_KEY"

  # --------------------------------------------------------------------------
  # BACKUP ENCRYPTION KEY
  # --------------------------------------------------------------------------
  backup-encryption-key: "CHANGE_ME_BACKUP_KEY"

  # --------------------------------------------------------------------------
  # VAULT TOKEN (if using Vault for dynamic secrets)
  # --------------------------------------------------------------------------
  # vault-token: "CHANGE_ME_VAULT_TOKEN"
  # vault-role: "erlmcp-production"

---
# ============================================================================
# TLS CERTIFICATES SECRET (separate from generic secrets)
# ============================================================================
# Use cert-manager for automatic certificate management:
# kubectl apply -f k8s/production/certificate.yaml
# ============================================================================
apiVersion: v1
kind: Secret
metadata:
  name: erlmcp-tls
  namespace: erlmcp-production
  labels:
    app: erlmcp
    component: tls
type: kubernetes.io/tls
data:
  # tls.crt: LS0tLS1CRUdJTi...
  # tls.key: LS0tLS1CRUdJTi...
  # ca.crt: LS0tLS1CRUdJTi...

---
# ============================================================================
# DOCKER REGISTRY SECRET
# ============================================================================
# For pulling images from private container registries
# Create with:
# kubectl create secret docker-registry ghcr-auth \
#   --docker-server=ghcr.io \
#   --docker-username=YOUR_USERNAME \
#   --docker-password=YOUR_TOKEN \
#   --namespace=erlmcp-production
# ============================================================================
#apiVersion: v1
#kind: Secret
#metadata:
#  name: ghcr-auth
#  namespace: erlmcp-production
#type: kubernetes.io/dockerconfigjson
#data:
#  .dockerconfigjson: BASE64_ENCODED_DOCKER_CONFIG

---
# ============================================================================
# CERTIFICATE RESOURCE (cert-manager)
# ============================================================================
# Requires cert-manager to be installed in the cluster
# https://cert-manager.io/
# ============================================================================
#apiVersion: cert-manager.io/v1
#kind: Certificate
#metadata:
#  name: erlmcp-tls
#  namespace: erlmcp-production
#spec:
#  secretName: erlmcp-tls
#  duration: 2160h # 90 days
#  renewBefore: 360h # 15 days before
#  subject:
#    organizations:
#      - erlmcp
#  commonName: erlmcp.example.com
#  isCA: false
#  privateKey:
#    algorithm: RSA
#    encoding: PKCS1
#    size: 2048
#  usages:
#    - server auth
#    - client auth
#  dnsNames:
#    - erlmcp.example.com
#    - api.erlmcp.example.com
#    - erlmcp-production.example.com
#  issuerRef:
#    name: letsencrypt-prod
#    kind: ClusterIssuer
#    group: cert-manager.io

---
# ============================================================================
# EXTERNAL SECRET TEMPLATE (External Secrets Operator)
# ============================================================================
# For using Vault, AWS Secrets Manager, or other external secret managers
# https://external-secrets.io/
# ============================================================================
#apiVersion: external-secrets.io/v1beta1
#kind: SecretStore
#metadata:
#  name: erlmcp-secret-store
#  namespace: erlmcp-production
#spec:
#  provider:
#    vault:
#      server: "https://vault.example.com"
#      path: "secret"
#      version: "v2"
#      auth:
#        kubernetes:
#          mountPath: "kubernetes"
#          role: "erlmcp-production"
#
#---
#apiVersion: external-secrets.io/v1beta1
#kind: ExternalSecret
#metadata:
#  name: erlmcp-secrets
#  namespace: erlmcp-production
#spec:
#  refreshInterval: 1h
#  secretStoreRef:
#    name: erlmcp-secret-store
#    kind: SecretStore
#  target:
#    name: erlmcp-secrets
#    creationPolicy: Owner
#  data:
#    - secretKey: erlang-cookie
#      remoteRef:
#        key: secret/erlmcp/production
#        property: erlang-cookie
#    - secretKey: db-password
#      remoteRef:
#        key: secret/erlmcp/production
#        property: db-password
#    - secretKey: jwt-secret
#      remoteRef:
#        key: secret/erlmcp/production
#        property: jwt-secret
#    - secretKey: redis-password
#      remoteRef:
#        key: secret/erlmcp/production
#        property: redis-password

---
# ============================================================================
# SEALED SECRET TEMPLATE (Sealed Secrets)
# ============================================================================
# For committing secrets to Git without exposing them
# https://github.com/bitnami-labs/sealed-secrets
# ============================================================================
# Create with: kubeseal -f k8s/production/secret.yaml -w k8s/production/sealed-secret.yaml
# ============================================================================
#apiVersion: bitnami.com/v1alpha1
#kind: SealedSecret
#metadata:
#  name: erlmcp-secrets
#  namespace: erlmcp-production
#spec:
#  encryptedData:
#    erlang-cookie: AgBy3i4OJSWK+PiTySY...
#    db-password: AgBy3i4OJSWK+PiTySY...
#    jwt-secret: AgBy3i4OJSWK+PiTySY...
#    redis-password: AgBy3i4OJSWK+PiTySY...

---
# ============================================================================
# SECRET GENERATION SCRIPT
# ============================================================================
# Save as: k8s/production/generate-secrets.sh
# ============================================================================
# #!/bin/bash
# set -euo pipefail
#
# NAMESPACE="erlmcp-production"
# SECRET_NAME="erlmcp-secrets"
#
# echo "Generating secrets for ErlMCP production..."
#
# # Generate random secrets
# ERLANG_COOKIE=$(openssl rand -base64 48 | tr -d '\n')
# JWT_SECRET=$(openssl rand -base64 32 | tr -d '\n')
# DB_PASSWORD=$(openssl rand -base64 24 | tr -d '\n')
# REDIS_PASSWORD=$(openssl rand -base64 24 | tr -d '\n')
# BACKUP_KEY=$(openssl rand -base64 32 | tr -d '\n')
#
# # Create Kubernetes secret
# kubectl create secret generic "${SECRET_NAME}" \
#   --from-literal=erlang-cookie="${ERLANG_COOKIE}" \
#   --from-literal=jwt-secret="${JWT_SECRET}" \
#   --from-literal=db-password="${DB_PASSWORD}" \
#   --from-literal=redis-password="${REDIS_PASSWORD}" \
#   --from-literal=backup-encryption-key="${BACKUP_KEY}" \
#   --namespace="${NAMESPACE}" \
#   --dry-run=client -o yaml | kubectl apply -f -
#
# echo "Secrets created successfully!"
# echo "IMPORTANT: Store these values securely!"
# echo "Erlang Cookie: ${ERLANG_COOKIE}"
# echo "JWT Secret: ${JWT_SECRET}"
# echo "DB Password: ${DB_PASSWORD}"
# echo "Redis Password: ${REDIS_PASSWORD}"
# echo "Backup Key: ${BACKUP_KEY}"
